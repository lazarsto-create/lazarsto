this.grid8player={layers:[],levels:{},loop:0,suppressEvents:false,playFirstTransition:false,bDebugMode:false,bDebugButton:"play",bMasterTimelineCompleted:false,mouseOverEnabled:true,bHoverTimelineCompleted:false,componentsToLoad:0,components:[],instancedComponents:[],effectsToLoad:0,effects:[],effectsToInit:[],instancedEffects:[],transitionsToLoad:0,transitions:[],transitionFrames:[],transitionInTimelines:{},transitionOutTimelines:{},instancedTransitions:[],previousTransitionFrame:null,videoDuration:0,shotTimelines:[],shotOutTimelines:[],beforeEndTimelines:[],customScriptsToExecute:[],globalScripts:function(){},timelineMaster:null,timelineHover:null,timelineClick:null,timelineSwipe:{left:null,right:null,up:null,down:null},currentShot:0,duration:0,editorMode:false,editedLayer:undefined,blockAnimations:false,originalManifest:undefined,swipeThreshold:10,shotsPlayedCounter:[],isInitiated:false,init:function(onReadyCallback){gsap.config({autoSleep:60,force3D:false,nullTargetWarn:false,trialWarn:true,units:{left:"%",top:"%",rotation:"deg"}});this.gsapSelector=gsap.utils.selector("#ad");const self=this;this.suppressEvents=manifest.settings.suppressEvents;this.initLevels();this.preProcessManifest();if(this.dynamicData["sequence"]!=undefined){let sequence=this.dynamicData["sequence"].split("|");this.preProcessDynamicData(sequence);this.initSequence(sequence)}else if(this.dynamicData["s0_shottype"]!=undefined||this.dynamicData["s0_shotType"]!=undefined||this.dynamicData["s0_ShotType"]!=undefined){let sequence=this.getDynamicSequence();this.preProcessDynamicData(sequence);this.initSequence(sequence)}else{this.preProcessDynamicData();this.initDefaultSequence()}this.originalManifest=JSON.parse(JSON.stringify(manifest));if(typeof this.postProcessManifest==="function")this.postProcessManifest(manifest);self.loadDynamicCSS(function(){self.loadFonts(function(){self.loadComponents(function(){self.loadEffects(function(){self.loadTransitions(function(){self.initLayers(function(){self.animationLoaded();self.buildTimelines();self.globalScripts();for(let i=0;i<self.customScriptsToExecute.length;i++){const cs=self.customScriptsToExecute[i];cs.onStart()}gsap.delayedCall(.1,function(){self.registerLayerEvents();self.hideMissingImages();externalAnimation(self.timelineMaster,self.getAllDOMLayers());window.addEventListener("resize",self.onResize);self.onResize();if(onReadyCallback!=undefined){onReadyCallback()}else gsap.delayedCall(.1,function(){if(manifest.settings.autoPlay===false){self.shotTimelines[0].play();self.currentShot=0;self.duration=self.timelineMaster.totalDuration()}else{self.timelineMaster.play();self.duration=self.timelineMaster.totalDuration()}})})})})})})})});this.initPlatformEvents();this.initTouchEvents()},initLevels(){$("#ad").innerHTML="";let levels=[...manifest.customLevels].reverse();levels.forEach(level=>{this.levels[level.id]=this.addLayerLevel("level-"+level.name)})},addLayerLevel(levelName){let levelElement=document.createElement("div");levelElement.id=levelName;gsap.set(levelElement,{width:"100%",height:"100%",position:"absolute",top:"0",left:"0",overflow:"hidden"});let ad=$("#ad");ad.appendChild(levelElement);return levelElement},loadDynamicCSS(callback){if(manifest.settings.useDynamicCSS){let dynamicValue=manifest.settings.dynamicValues.find(x=>x.id===manifest.settings.dynamicCSS);let variableName=dynamicValue.name;if(dynamicValue.shotLevel===true)variableName="s0_"+variableName;if((variableName==undefined||grid8player.dynamicData[variableName]==undefined)&&manifest.settings.defaultDynamicCSS==undefined){callback();return}let path=grid8player.dynamicData[variableName];if(path==undefined)path=manifest.settings.defaultDynamicCSS;const fileref=document.createElement("link");fileref.rel="stylesheet";fileref.type="text/css";fileref.onload=function(){const fontPromises=[];document.fonts.ready.then(async fontFaceSet=>{const fontFaces=[...fontFaceSet];for(const fontFace of fontFaces){const loadedPromise=fontFace.load();fontPromises.push(loadedPromise)}try{await Promise.all(fontPromises);callback()}catch(error){console.error("error loading css fonts:",error)}})}.bind(this);if(!/\.css$/.test(path)){path+=".css"}let prefix="";if(manifest.settings.remoteCSSPath!=undefined){prefix=manifest.settings.remoteCSSPath;if(!prefix.endsWith("/")){prefix+="/"}}fileref.href=prefix+path;document.getElementsByTagName("head")[0].appendChild(fileref)}else callback()},preProcessDynamicData(sequence){const valuesToOverwrite=[];const sequenceLength=sequence==undefined?manifest.shots.length:sequence.length;for(const key in this.dynamicData){if(key.includes("important_")){valuesToOverwrite.push({key:key.replace("important_",""),value:grid8player.dynamicData[key]})}}valuesToOverwrite.forEach(value=>{for(const key in dynamicData){if(key.includes(value.key)){this.dynamicData[key]=value.value}}});manifest.settings.dynamicValues.filter(x=>x.shotLevel!=true).forEach(x=>{let defaultValue=x.defaultValue;if(defaultValue!=undefined){if(this.dynamicData[x.name]==undefined)this.dynamicData[x.name]=defaultValue}});manifest.settings.dynamicValues.filter(x=>x.shotLevel==true).forEach(x=>{let defaultValue=x.defaultValue;for(let s=0;s<sequenceLength;s++){if(defaultValue!=undefined){if(this.dynamicData[`s${s}_${x.name}`]==undefined)this.dynamicData[`s${s}_${x.name}`]=defaultValue}}})},preProcessManifest(){this.preProcessDynamicValues();this.preProcessPresets();this.preProcessCustomEases();this.preProcessFonts()},preProcessDynamicValues(){if(manifest.settings.legacyDynamicValues!==false)return;manifest.layers.forEach(layer=>{if(layer.dynamicValue!=undefined){let dynamicValueName=manifest.settings.dynamicValues.find(x=>x.id===layer.dynamicValue);if(dynamicValueName!=undefined)layer.dynamicValue=dynamicValueName.name}})},preProcessCustomEases(){if(manifest.customEases==undefined)return;manifest.layers.forEach(layer=>{layer.shots.forEach(shot=>{shot.timelines.forEach(timeline=>{timeline.steps.forEach(step=>{let customeEase=manifest.customEases.find(x=>x.id===step.settings.ease);if(customeEase!=undefined&&customeEase.easeType==="param")step.settings.ease=customeEase.value;else if(customeEase!=undefined&&customeEase.easeType==="function")step.settings.ease=customeEase.name})})})})},preProcessPresets(){manifest.layers.forEach(layer=>{layer.shots.forEach(shot=>{shot.timelines.forEach(timeline=>{timeline.steps.forEach(step=>{let presetName=step.settings.preset;if(presetName.indexOf("from")!==-1)step.settings.animationType="from";else if(presetName.indexOf("to")!==-1)step.settings.animationType="to";if(presetName.indexOf("⭢")!==-1)step.settings.preset="⭢";else if(presetName.indexOf("⭠")!==-1)step.settings.preset="⭠";else if(presetName.indexOf("⭣")!==-1)step.settings.preset="⭣";else if(presetName.indexOf("Scale")!==-1)step.settings.preset="Scale";else if(presetName.indexOf("Fade")!==-1)step.settings.preset="Fade";else step.settings.preset=presetName})})})})},preProcessFonts(){let availableFonts=manifest.settings.webFonts.filter(x=>x.isDeleted!==true);manifest.layers.forEach(layer=>{if(layer.fileType==="text"){let aliasFont=availableFonts.find(font=>font.fontFamily===layer.fontFamily&&font.fontStyle===layer.fontStyle);if(aliasFont==undefined){aliasFont=availableFonts.find(font=>font.fontFamilyUser===layer.fontFamily&&font.fontStyleUser===layer.fontStyle)}if(aliasFont!=undefined&&aliasFont.alias!=undefined&&aliasFont.alias.length>0){layer.fontFamily=aliasFont.alias}}})},getDynamicSequence(){let sequence=[];for(const[key,value]of Object.entries(this.dynamicData)){if(key[0]==="s"&&key.split("_")[1]!=undefined){let index=Number(key.split("_")[0].replace("s",""));let valueName=key.split("_")[1];if(valueName.toLocaleLowerCase()==="shottype")sequence.push(value)}}return sequence},initSequence:function(sequence){const{duplicatedShots,duplicatedLayers}=this.duplicateShotsAndLayers(manifest.shots,manifest.layers,sequence);manifest.shots=duplicatedShots;manifest.layers=duplicatedLayers},initDefaultSequence(){if(this.isInitiated===true)return;manifest.shots.forEach(shot=>{let usedLayers=manifest.layers.filter(l=>l.shots.find(ls=>ls.index===shot.index));usedLayers.forEach(layer=>{if(layer.isDynamic===true){let dynamicValue=manifest.settings.dynamicValues.find(x=>x.name===layer.dynamicValue);if(dynamicValue==undefined)return;if(dynamicValue.shotLevel===true)layer.dynamicValue=`s${shot.index}_${layer.dynamicValue}`;else layer.dynamicValue=`${layer.dynamicValue}`}})})},duplicateShotsAndLayers:function(shots,layers,sequence){const duplicatedShots=[];const duplicatedLayers=[];for(let i=0;i<sequence.length;i++){const shotIndex=sequence[i];let originalShot=shots.find(s=>s.name===shotIndex);if(originalShot==undefined)originalShot=shots[parseInt(shotIndex)];if(originalShot==undefined)originalShot=shots[0];let duplicatedShot=JSON.parse(JSON.stringify(originalShot));if(duplicatedShot.transitions!=undefined&&duplicatedShot.transitions.length>0){let newTransition=duplicatedShot.transitions[0];this.duplicateDynamicValue(newTransition,i)}Object.assign(duplicatedShot,{index:i,originalIndex:originalShot.index});duplicatedShots.push(duplicatedShot)}duplicatedShots.forEach(shot=>{let usedLayers=layers.filter(l=>l.shots.find(ls=>ls.index===shot.originalIndex));usedLayers.forEach(originalLayer=>{let duplicatedLayer=JSON.parse(JSON.stringify(originalLayer));if(duplicatedLayer.componentManifest!=undefined){let componentManifest=duplicatedLayer.componentManifest;if(componentManifest.dynamicValue!=undefined)this.duplicateDynamicValue(componentManifest,shot.index)}if(duplicatedLayer.effects!=undefined){duplicatedLayer.effects.forEach(effect=>{if(effect.dynamicValue!=undefined)this.duplicateDynamicValue(effect,shot.index)})}if(duplicatedLayer.isDynamic===true){let dynamicValue=manifest.settings.dynamicValues.find(x=>x.name===duplicatedLayer.dynamicValue);if(dynamicValue==undefined)console.error(`Dynamic Variable not found in dynamic layer ${duplicatedLayer.name}`);else if(dynamicValue.shotLevel===true)duplicatedLayer.dynamicValue=`s${shot.index}_${duplicatedLayer.dynamicValue}`;else duplicatedLayer.dynamicValue=`${duplicatedLayer.dynamicValue}`}duplicatedLayer.shots=[];originalLayer.shots.forEach(layerShot=>{if(layerShot.index===shot.originalIndex){let newShot=JSON.parse(JSON.stringify(layerShot));Object.assign(newShot,{index:shot.index,originalIndex:shot.originalIndex,guid:layerShot.guid+"-"+shot.index});duplicatedLayer.shots.push(newShot)}});Object.assign(duplicatedLayer,{guid:originalLayer.guid+"-"+shot.index});if(duplicatedLayer.parent!=undefined)duplicatedLayer.parent+="-"+shot.index;duplicatedLayers.push(duplicatedLayer)})});return{duplicatedShots:duplicatedShots,duplicatedLayers:duplicatedLayers}},duplicateDynamicValue(componentManifest,shotIndex){if(componentManifest.dynamicValue==undefined)return;let existingDynamicValue=JSON.parse(JSON.stringify(manifest.settings.dynamicValues.find(x=>x.id===componentManifest.dynamicValue)));componentManifest.dynamicValue+=`-s${shotIndex}`;existingDynamicValue.id+=`-s${shotIndex}`;existingDynamicValue.name=`s${shotIndex}_${existingDynamicValue.name}`;manifest.settings.dynamicValues.push(existingDynamicValue)},initTouchEvents(){let touchStartX=0;let touchStartY=0;let touchEndX=0;let touchEndY=0;let self=this;function handleGesture(touchStartX,touchStartY,touchEndX,touchEndY){const deltaX=touchEndX-touchStartX;const deltaY=touchEndY-touchStartY;if(Math.abs(deltaX)>Math.abs(deltaY)){if(Math.abs(deltaX)<self.swipeThreshold)return{type:"tap"};if(deltaX>0)return{type:"right",x:deltaX,y:deltaY};else return{type:"left",x:deltaX,y:deltaY}}else if(Math.abs(deltaX)<Math.abs(deltaY)){if(Math.abs(deltaY)<self.swipeThreshold)return"tap";if(deltaY>0)return{type:"down",x:deltaX,y:deltaY};else return{type:"up",x:deltaX,y:deltaY}}else return"tap"}function onTouchStart(event){if(event.button===2){return}touchStartX=isTouch()&&event.changedTouches.length>0?event.changedTouches[0].screenX:event.clientX;touchStartY=isTouch()&&event.changedTouches.length>0?event.changedTouches[0].screenY:event.clientY}function onTouchEnd(event){if(event.button===2){return}touchEndX=isTouch()&&event.changedTouches.length>0?event.changedTouches[0].screenX:event.clientX;touchEndY=isTouch()&&event.changedTouches.length>0?event.changedTouches[0].screenY:event.clientY;let swipe=handleGesture(touchStartX,touchStartY,touchEndX,touchEndY);switch(swipe.type){case"tap":window.onClick();break;default:self.onSwipe(swipe)}}const clickLayer=document.getElementById("ad");clickLayer.addEventListener("pointerdown",onTouchStart,false);clickLayer.addEventListener("pointerup",onTouchEnd,false);clickLayer.onclick=function(){};if(!isTouch()){}},initPlatformEvents(){},playShot:function(index){let outDuration=0;let self=this;if(index===this.currentShot||manifest.settings.autoPlay===true)return;if(this.currentShot!=null){if((new Error).stack.indexOf("nav8.js")>-1)this.shotTimelines[this.currentShot].progress(1,false);if(this.shotOutTimelines.length>this.currentShot)this.shotOutTimelines[this.currentShot].play(0);if(this.shotOutTimelines.length>this.currentShot)outDuration=this.shotOutTimelines[this.currentShot].totalDuration();this.blockAnimations=true}self.previousShot=self.currentShot;self.currentShot=index;gsap.delayedCall(outDuration-parseFloat(manifest.settings.overlapBetweenShots),function(){outDuration=self.shotTimelines[self.currentShot].totalDuration();gsap.delayedCall(outDuration,function(){self.blockAnimations=false});self.shotTimelines[self.currentShot].play(0);self.onShotStart(manifest.shots[self.currentShot]);self.playTransitionTimeline(self.currentShot)})},showShot:function(index){this.currentShot=index;for(let l=0;l<manifest.layers.length;l++){let layer=manifest.layers[l];let visibility="hidden";let opacity=0;if(layer.shots.find(x=>x.index===index)){visibility="visible";opacity=1}let dom=$("#layer-"+layer.guid);dom.style.visibility=visibility;dom.style.opacity=opacity;this.shotTimelines[index].timeScale(100);this.shotTimelines[index].play(0);gsap.delayedCall(.1,function(){this.shotTimelines[index].timeScale(1)}.bind(this));this.editLayer("")}},editLayer:function(id){this.resizable=$(".resizable")[0];let layer=$(id);if(layer==undefined){this.resizable.style.display="none";return}this.resizable.style.display="block";this.resizable.style.width=layer.offsetWidth+"px";this.resizable.style.height=layer.offsetHeight+"px";this.resizable.style.transform=layer.style.transform;this.editedLayer=layer;this.initResizable();this.editorMode=true},initResizable:function(){let resizable=this.resizable;let resizers=$(".resizer");let rotators=$(".rotator");let xdLayer=this.getLayerByID(grid8player.editedLayer.id.replace("layer-",""));for(let index=0;index<resizers.length;index++){const resizer=resizers[index];resizer.onmousedown=function(event){event.preventDefault();event.stopPropagation();let shiftX=event.clientX-getTranslateXY(resizer).x;let shiftY=event.clientY-getTranslateXY(resizer).y;let originalWidth=parseInt(resizable.style.width);let originalHeight=parseInt(resizable.style.height);let originalX=getTranslateXY(resizable).x;let originalY=getTranslateXY(resizable).y;function scaleAt(pageX,pageY,e){let x=pageX-shiftX;if(resizer.classList.contains("bottom-left")||resizer.classList.contains("top-left"))x=-(pageX-shiftX);let y=pageY-shiftY;if(resizer.classList.contains("top-right")||resizer.classList.contains("top-left"))y=-(pageY-shiftY);if(!e.shiftKey&&xdLayer.fileType!=="text"){let total=x+y;x=total;let ratio=(originalWidth+x)/originalWidth;y=ratio*originalHeight-originalHeight}let pX=originalX-x/2+"px";let pY=originalY-y/2+"px";grid8player.editedLayer.style.width=resizable.style.width=originalWidth+x+"px";grid8player.editedLayer.style.height=resizable.style.height=originalHeight+y+"px";gsap.set([grid8player.editedLayer,resizable],{x:pX,y:pY})}function onMouseMove(event){scaleAt(event.pageX,event.pageY,event)}function cancelDrag(){resizer.onmouseup=null;document.removeEventListener("mousemove",onMouseMove);document.removeEventListener("onmouseup",onMouseMove);grid8player.saveToManifest(grid8player.editedLayer,getTranslateXY(resizable).x,getTranslateXY(resizable).y,grid8player.editedLayer.style.width,grid8player.editedLayer.style.height)}document.addEventListener("mousemove",onMouseMove);document.addEventListener("mouseup",cancelDrag)}}for(let index=0;index<rotators.length;index++){const rotator=rotators[index];rotator.onmousedown=function(event){event.preventDefault();event.stopPropagation();let shiftX=event.clientX-getTranslateXY(rotator).x;let shiftY=event.clientY-getTranslateXY(rotator).y;let originalRotationX=getRotation(resizable).x;let originalRotationY=getRotation(resizable).y;let originalRotationZ=getRotation(resizable).z;let originalX=getTranslateXY(resizable).x;let originalY=getTranslateXY(resizable).y;const boundingRect=grid8player.editedLayer.getBoundingClientRect();const centerX=boundingRect.left+boundingRect.width/2;const centerY=boundingRect.top+boundingRect.height/2;function scaleAt(pageX,pageY,e){let y=pageX-shiftX;let x=pageY-shiftY;let z=x+y+originalRotationZ;x=y=0;const center_x=originalX;const center_y=originalY;const mouse_x=pageX;const mouse_y=pageY;const radians=Math.atan2(mouse_x-centerX,mouse_y-centerY);const degree=radians*(180/Math.PI)*-1+180;z=degree;if(!e.shiftKey){z=Math.round(z/45)*45}gsap.set([grid8player.editedLayer,resizable],{x:originalX,y:originalY,rotationX:originalRotationX+x,rotationY:originalRotationY+y,rotationZ:z})}function onMouseMove(event){scaleAt(event.pageX,event.pageY,event)}function cancelDrag(){rotator.onmouseup=null;document.removeEventListener("mousemove",onMouseMove);document.removeEventListener("onmouseup",onMouseMove);grid8player.saveToManifest(grid8player.editedLayer,getTranslateXY(resizable).x,getTranslateXY(resizable).y,grid8player.editedLayer.style.width,grid8player.editedLayer.style.height,getRotation(resizable).x,getRotation(resizable).y,getRotation(resizable).z)}document.addEventListener("mousemove",onMouseMove);document.addEventListener("mouseup",cancelDrag)}}resizable.onmousedown=function(event){event.preventDefault();event.stopPropagation();let shiftX=event.clientX-getTranslateXY(resizable).x;let shiftY=event.clientY-getTranslateXY(resizable).y;let originalWidth=parseInt(resizable.style.width);let originalHeight=parseInt(resizable.style.height);let target=event.target;function moveAt(pageX,pageY){let x=pageX-shiftX+"px";let y=pageY-shiftY+"px";gsap.set([grid8player.editedLayer,resizable],{x:x,y:y,rotationX:getRotation(grid8player.editedLayer).x,rotationY:getRotation(grid8player.editedLayer).y,rotationZ:getRotation(grid8player.editedLayer).z})}function onMouseMove(event){moveAt(event.pageX,event.pageY)}document.addEventListener("mousemove",onMouseMove);resizable.onmouseup=function(){document.removeEventListener("mousemove",onMouseMove);resizable.onmouseup=null;grid8player.saveToManifest(grid8player.editedLayer,getTranslateXY(resizable).x,getTranslateXY(resizable).y)};resizable.onmouseleave=function(){document.removeEventListener("mousemove",onMouseMove);resizable.onmouseleave=null;grid8player.saveToManifest(grid8player.editedLayer,getTranslateXY(resizable).x,getTranslateXY(resizable).y)}}},saveToManifest:function(layer,x,y,w,h,rx,ry,rz){let shotIndex=this.currentShot;let l=manifest.layers.find(x=>`layer-${x.guid}`===layer.id);let shot=l.shots.find(x=>x.index===this.currentShot);shot.pos.x=parseFloat(x);shot.pos.y=parseFloat(y);if(w!=undefined)shot.size.initW=parseFloat(w);if(h!=undefined)shot.size.initH=parseFloat(h);if(rx!=undefined)shot.rotationX=rx;if(ry!=undefined)shot.rotationY=ry;if(rz!=undefined)shot.rotation=rz},rebuild:function(){let shotIndex=this.currentShot;this.initLayers(function(){for(let i=0;i<manifest.layers.length;i++){let tempLayer=manifest.layers[i];let visibility="hidden";let opacity=0;if(tempLayer.shots.find(x=>x.index===shotIndex)){visibility="visible";opacity=1}let dom=$("#layer-"+tempLayer.guid);dom.style.visibility=visibility;dom.style.opacity=opacity}grid8player.shotTimelines[shotIndex].pause(grid8player.shotTimelines[shotIndex].duration());this.editLayer("#"+this.editedLayer.id)}.bind(this))},onVideoReady:function(){this.animationLoaded();this.buildTimelines();this.timelineMaster.pause();this.waitForVideoAndPlay()},waitForVideoAndPlay(){let self=this;setTimeout(()=>{if(video.currentTime===0){self.waitForVideoAndPlay();return}self.timelineMaster.play(video.currentTime);$("#ad").style.opacity=1;$("#border").style.opacity=1},100)},buildTimelines:function(){this.customScriptsToExecute=[];this.shotsPlayedCounter=[];this.shotTimelines=[];this.shotOutTimelines=[];this.beforeEndTimelines=[];this.timelineMaster=gsap.timeline({repeat:GetValue(manifest.settings.loop),repeatDelay:GetValue(manifest.settings.loopDelay),paused:true,onComplete:this.onComplete.bind(this),onUpdate:this.onUpdate});this.timelineHover=gsap.timeline({paused:true,onComplete:this.onHoverComplete.bind(this)});this.timelineSwipe["left"]=gsap.timeline({paused:true});this.timelineSwipe["right"]=gsap.timeline({paused:true});this.timelineSwipe["up"]=gsap.timeline({paused:true});this.timelineSwipe["down"]=gsap.timeline({paused:true});this.timelineClick=gsap.timeline({paused:true,onComplete:this.onHoverComplete.bind(this)});let previousShotDelay=0;let totalDelay=0;const overlap=manifest.settings.overlapBetweenShots;for(let i=0;i<manifest.shots.length;i++){const timelines=this.buildShotTimeline(manifest.shots[i]);if(i!==0)this.timelineMaster.to(`.shot${i}`,{},0);if(manifest.settings.autoPlay==true||manifest.settings.autoPlay==undefined){let shotDelay=0;shotDelay=previousShotDelay;if(!isNaN(manifest.shots[i].duration)&&manifest.shots[i].duration!==""){previousShotDelay=parseFloat(manifest.shots[i].duration)}else{previousShotDelay=timelines.shotTimeline.totalDuration()}this.timelineClick.add(timelines.clickTimeline,0);totalDelay+=shotDelay;this.timelineMaster.addLabel(`shot${i}`,totalDelay);this.timelineMaster.add(timelines.shotTimeline,totalDelay);if(i<manifest.shots.length-1){this.timelineMaster.add(timelines.shotOutTimeline,totalDelay+previousShotDelay);let beforeTime=totalDelay+previousShotDelay-timelines.beforeEndTimeline.beforeTime;this.timelineMaster.add(timelines.beforeEndTimeline,beforeTime)}timelines.shotOutTimeline.paused=false;timelines.beforeEndTimeline.paused=false;this.timelineMaster.to(`.shot${i}`,{visibility:"visible"},totalDelay)}else{this.shotOutTimelines.push(timelines.shotOutTimeline);this.beforeEndTimelines.push(timelines.beforeEndTimeline);this.timelineMaster.addLabel(`shot${i}`,this.timelineMaster.duration())}if(i===manifest.shots.length-1&&!isNaN(manifest.shots[i].duration)){let duration=parseFloat(manifest.shots[i].duration);if(this.hiddenFakeElement==undefined){let fakeElement=document.createElement("p");document.body.appendChild(fakeElement);this.hiddenFakeElement=fakeElement}this.timelineMaster.to(this.hiddenFakeElement,{duration:duration},totalDelay)}this.shotTimelines.push(timelines.shotTimeline);this.timelineHover.add(timelines.hoverTimeline,0);this.timelineSwipe["left"].add(timelines.swipeLeftTimeline,0);this.timelineSwipe["right"].add(timelines.swipeRightTimeline,0);this.timelineSwipe["up"].add(timelines.swipeUpTimeline,0);this.timelineSwipe["down"].add(timelines.swipeDownTimeline,0)}},onShotStart:function(shot){let self=this;let previousShot=this.currentShot;let transitionFrame=$(`.transition-frame shot-${shot.index}`)[0];if(transitionFrame!=undefined)self.setHidden8(transitionFrame,false);for(let i=0;i<this.layers.length;i++){const layer=this.layers[i];if(layer.shots[0].index===shot.index){layer.div.classList.remove("hidden8");let component=layer.div.component;if(component!=undefined){if(typeof component.onStart==="function")component.onStart(self.shotsPlayedCounter.indexOf(shot.index)===-1)}if(layer.div.effects!=undefined){layer.div.effects.forEach(effect=>{if(typeof effect.onStart==="function")effect.onStart(self.shotsPlayedCounter.indexOf(shot.index)===-1)})}}}const isFirst=shot.index===0&&self.shotsPlayedCounter.length===0;this.currentShot=shot.index;if(manifest.settings.autoPlay!==true){if(manifest.settings.playFirstTransition!==false&&isFirst&&manifest.settings.autoPlay!==true){self.playTransitionTimeline(self.currentShot)}}if(self.shotsPlayedCounter.indexOf(shot.index)===-1)self.shotsPlayedCounter.push(shot.index);if(shot.index>0){}if(this.currentShot!==previousShot)this.onShotChange(shot)},setHidden8(element,show){if(show)element.classList.add("hidden8");else element.classList.remove("hidden8");return;function toggleHiddenClass(el,isHidden){if(isHidden){el.classList.add("hidden8")}else{el.classList.remove("hidden8")}}toggleHiddenClass(element,!show);const childElements=element.querySelectorAll("*");childElements.forEach(childElement=>{toggleHiddenClass(childElement,!show)})},onShotChange(shot){let transitionFrame=document.querySelector(".transition-frame.shot-"+shot.index);if(transitionFrame){this.setHidden8(transitionFrame,false)}for(let i=0;i<this.layers.length;i++){const layer=this.layers[i];let layerShot=layer.shots.find(s=>s.index===shot.index);if(layerShot!=undefined){if(layer.div.parentNode==undefined){console.log("no parent")}else this.setLayerInitialPosition(layer.div,layerShot)}let component=layer.div.component;if(component!=undefined){if(typeof component.onShotChange==="function")component.onShotChange(shot)}if(layer.div.effects!=undefined){layer.div.effects.forEach(effect=>{if(typeof effect.onShotChange==="function")effect.onShotChange(shot)})}}},setLayerInitialPosition(div,shot,initial){let xdLayer=this.getLayerFromDOMID(div.id);if(initial==undefined){if(manifest.settings.autoPlay!==false)return;let containsShotTransition=false;shot.timelines.forEach(timeline=>{timeline.steps.forEach(step=>{if(step.settings.preset==="Transition")containsShotTransition=true})});if(containsShotTransition)return;if(div.parentNode.classList.contains("transition-frame"))return}let layerWidth=shot.size.initW;let layerHeight=shot.size.initH;let layerX=shot.pos.x;let layerY=shot.pos.y;let diffX=shot.size.w-shot.size.initW;let diffY=shot.size.h-shot.size.initH;if(xdLayer.fileType==="text"&&xdLayer.layoutBox==="point")layerWidth="auto";if(this.hasCustomSLIP(div)){this.callCustomSLIP(div)}else{gsap.set(div,{x:layerX,y:layerY,rotationZ:shot.rotation??0,rotationX:shot.rotationX??0,rotationY:shot.rotationY??0,width:layerWidth,height:layerHeight,opacity:shot.opacity})}},hasCustomSLIP(div){let result=false;div.effects.forEach(e=>{if(e.setLayerInitialPosition!=undefined)result=true});if(div.component&&div.component.setLayerInitialPosition)result=true;return result},callCustomSLIP(div){div.effects.forEach(e=>{if(e.setLayerInitialPosition!=undefined){e.setLayerInitialPosition()}});if(div.component&&div.component.setLayerInitialPosition)div.component.setLayerInitialPosition()},buildShotTimeline:function(shot){let animation;let isLastShot=manifest.shots[manifest.shots.length-1].index==shot.index;const timelines={shotTimeline:manifest.settings.autoPlay===false&&!(manifest.settings.playFirstTransition!==false&&shot.index===0)?gsap.timeline({paused:true,onStart:this.onShotStart.bind(this),onStartParams:[shot]}):gsap.timeline({paused:false,onStart:this.onShotStart.bind(this),onStartParams:[shot]}),shotOutTimeline:gsap.timeline({paused:manifest.settings.autoPlay!==false?false:true}),beforeEndTimeline:gsap.timeline({paused:manifest.settings.autoPlay!==false?false:true}),hoverTimeline:gsap.timeline(),swipeLeftTimeline:gsap.timeline(),swipeRightTimeline:gsap.timeline(),swipeUpTimeline:gsap.timeline(),swipeDownTimeline:gsap.timeline(),clickTimeline:gsap.timeline(),shotTimeLineDelay:0};const staggers={};if(manifest.customLabels==undefined)manifest.customLabels=[];for(let index=0;index<manifest.customLabels.length;index++){const label=manifest.customLabels[index];if(label.labelType==="before end"||label.labelType==="after end"){if(isLastShot){}else if(label.labelType=="after end"){timelines.shotOutTimeline.addLabel(label.id+"-"+shot.index,"+="+label.time)}else if(label.labelType=="before end"){"";const str=label.id;const regExp=/-(\d)$/;const match=str.match(regExp);let num=match?match[1]:null;if(str.endsWith("-x")==false&&(num==null||isNumber(num)&&num==shot.index))timelines.beforeEndTimeline.beforeTime=parseFloat(label.time);timelines.beforeEndTimeline.addLabel(label.id+"-"+shot.index,"-="+label.time)}}else timelines.shotTimeline.addLabel(label.id+"-"+shot.index,label.time)}const triggers=[];timelines.shotTimeLineDelay=this.getNegativeDelay(shot);for(let i=0;i<manifest.layers.length;i++){const layer=manifest.layers[i];const shotInLayer=this.getShotInLayer(layer,shot.index);const domLayer=document.getElementById("layer-"+layer.guid);if(domLayer==undefined)break;if(domLayer.component!=undefined&&domLayer.component.animate!=undefined&&shotInLayer!=undefined&&!layer.isCSSMask){domLayer.component.animate(timelines.shotTimeline)}if(domLayer.effects!=undefined&&shotInLayer!=undefined&&!layer.isCSSMask){domLayer.effects.forEach(effect=>{if(effect.animate!=undefined)effect.animate(timelines.shotTimeline)})}if(shotInLayer!=null){if(shotInLayer.name==="video-layer"){const vtl=gsap.timeline();vtl.to("#empty-video",{duration:this.videoDuration})}for(let t=0;t<shotInLayer.timelines.length;t++){const timeline=shotInLayer.timelines[t];let skipTimeline=false;if(timeline.trigger=="Timestamp"){let customLabel=manifest.customLabels.find(x=>x.id===timeline.customLabel);if(customLabel!=undefined&&(customLabel.labelType=="after end"||customLabel.labelType=="before end")&&isLastShot)skipTimeline=true}if(timeline.trigger==="None"||timeline.trigger==="Disabled"||skipTimeline)continue;let animationGroup=this.getAnimationGroup(timeline.trigger);if(animationGroup!=null){let animationGroupName=animationGroup.name+"_"+timeline.customLabel;if(staggers[animationGroupName]==undefined)staggers[animationGroupName]={elements:[],settings:animationGroup,label:timeline.customLabel};domLayer[animationGroupName+"-order"]=timeline.groupAnimationOrder;if(domLayer.splitText!=undefined){if(layer.textAnimation.type==="chars")staggers[animationGroupName].elements.push(domLayer.splitText.chars);else if(layer.textAnimation.type==="lines")staggers[animationGroupName].elements.push(domLayer.splitText.lines);else staggers[animationGroupName].elements.push(domLayer.splitText.words)}else staggers[animationGroupName].elements.push(domLayer)}else{const tl=gsap.timeline();if(tl!=null&&timeline.trigger==="Timestamp"){}for(let s=0;s<timeline.steps.length;s++){var settings=timeline.steps[s].settings;const posX=GetValue(settings.preset==="⭠"?settings.x:settings.x);const posY=GetValue(settings.preset==="⭡"?settings.y:settings.y);animation={ease:settings.ease,scale:settings.scale===""||settings.scale==undefined?undefined:GetValue(settings.scale),opacity:settings.preset==="Transition"?1:settings.opacity===""||settings.opacity==undefined?undefined:GetValue(settings.opacity),duration:GetValue(settings.duration)};if(animation.opacity==undefined)delete animation.opacity;if(animation.scale==undefined)delete animation.scale;if(animation.duration===0)animation.duration=1e-4;if(posX!==0)animation.x="+="+posX;if(posY!==0)animation.y="+="+posY;if(settings.preset.indexOf("GSAP Expression")!=-1){animation={duration:GetValue(settings.duration),ease:settings.ease};animation=Object.assign(animation,JSON.parse(settings.customScript))}else if(settings.preset==="Transition"){let domWidth=domLayer.width;let domHeight=domLayer.height;if(isNaN(domWidth)||domWidth==="")domWidth=domLayer.clientWidth;if(isNaN(domHeight)||domHeight==="")domHeight=domLayer.clientHeight;animation={x:shotInLayer.pos.x+(shotInLayer.size.initW-domWidth)/2,y:shotInLayer.pos.y+(shotInLayer.size.initH-domHeight)/2,scaleX:shotInLayer.size.initW/domWidth,scaleY:shotInLayer.size.initH/domHeight,rotationZ:GetValue(shotInLayer.rotation),opacity:shotInLayer.opacity,duration:GetValue(settings.duration),ease:settings.ease};if(settings.transitPosition===false){delete animation.x;delete animation.y}if(settings.transitScale===false){delete animation.scale}if(settings.transitRotation===false){delete animation.rotationZ}}else{delete animation.rotation;if(settings.rotationX!=undefined&&settings.rotationX!=="")animation.rotationX="+="+GetValue(settings.rotationX);if(settings.rotationY!=undefined&&settings.rotationY!=="")animation.rotationY="+="+GetValue(settings.rotationY);if(settings.rotationZ!=undefined&&settings.rotationZ!=="")animation.rotationZ="+="+GetValue(settings.rotationZ)}let delay=GetValue(settings.delay);if(delay<0){if(shot.index===layer.shots[0].index&&s===0){delay=(timelines.shotTimeLineDelay-delay)*-1;delay="+="+delay}else delay="-="+delay*-1}else{delay+=timelines.shotTimeLineDelay*-1;delay="+="+delay}const customPreset=this.getPreset(settings.preset);if(customPreset!=null){let presetData=customPreset.gsap;if(settings.overwritePreset===true)presetData=settings.presetOverwriteData;eval("animation ="+presetData)}if(settings.preset==="Custom Script"){let cs=settings.customScript;eval(`animation.onStart = function () {
                                    let shotIndex = shot.index;
                                    let shotTimeline = timelines.shotTimeline;
                                    ${cs}
                                }.bind(domLayer);`);if(settings.delay===""){this.customScriptsToExecute.push(animation)}else{tl.to("#layer-"+layer.guid,animation,delay)}}else if(timeline.trigger==="Custom Event"){if(settings.animationType=="from"){tl.from("#layer-"+layer.guid,animation,delay)}else tl.to("#layer-"+layer.guid,animation,delay)}else if(settings.animationType==="from"&&settings.preset!=="Transition"&&timeline.trigger!=="On Hover Ad"&&timeline.trigger!=="On Hover Layer"&&timeline.trigger!=="On Click Layer")tl.from("#layer-"+layer.guid,animation,delay);else tl.to("#layer-"+layer.guid,animation,delay)}if(timeline.trigger==="None"||timeline.trigger==="Disabled"){}else if(tl!=null&&timeline.trigger==="Timestamp"&&(timeline.customLabel==="Auto"||timeline.customLabel==="")){timelines.shotTimeline.add(tl,"<")}else if(tl!=null&&timeline.trigger==="Timestamp"){let customLabel=manifest.customLabels.find(x=>x.id===timeline.customLabel);if(customLabel.labelType==="before end"){if(!isLastShot){timelines.beforeEndTimeline.add(tl,0)}}else if(customLabel.labelType==="after end"){if(!isLastShot){timelines.shotOutTimeline.add(tl,timeline.customLabel+"-"+shot.index)}}else timelines.shotTimeline.add(tl,timeline.customLabel+"-"+shot.index)}else if(tl!=null&&timeline.trigger==="Swipe Left"){timelines.swipeLeftTimeline.add(tl,"<")}else if(tl!=null&&timeline.trigger==="Swipe Right"){timelines.swipeRightTimeline.add(tl,"<")}else if(tl!=null&&timeline.trigger==="Swipe Top"){timelines.swipeUpTimeline.add(tl,"<")}else if(tl!=null&&timeline.trigger==="Swipe Bottom"){timelines.swipeDownTimeline.add(tl,"<")}else if(tl!=null&&timeline.trigger==="On Hover Ad"){timelines.hoverTimeline.add(tl,"<")}else if(tl!=null&&timeline.trigger==="On Hover Layer"){if(domLayer.hoverLayerTimelines==undefined)domLayer.hoverLayerTimelines=[];tl.pause(0);domLayer.hoverLayerTimelines.push({shot:shot.index,timeline:tl})}else if(tl!=null&&timeline.trigger==="On Click Ad"){timelines.clickTimeline.add(tl,"<")}else if(tl!=null&&timeline.trigger==="On Click Layer"){if(domLayer.clickLayerTimelines==undefined)domLayer.clickLayerTimelines=[];tl.pause(0);domLayer.clickLayerTimelines.push({shot:shot.index,timeline:tl})}else if(tl!=null&&timeline.trigger==="Custom Event"){if(domLayer.customEventTimelines==undefined)domLayer.customEventTimelines=[];let customEvent=manifest.customEvents.find(x=>x.id==timeline.customEvent);domLayer.customEventTimelines.push({shot:shot.index,customEvent:customEvent,timeline:tl});var settings=timeline.steps[0].settings;tl.pause(0)}else if(tl!=null&&(timeline.trigger==="Animate Out"||manifest.animationGroups.find(g=>g.id===timeline.trigger).name.indexOf("ANIMOUT")!==-1)){timelines.shotOutTimeline.add(tl,"<")}else if(timeline.trigger==="With Layer Animation"){triggers.push({timeline:timeline,id:shot.index+"-"+this.getLayerIDFromName(layer.name),label:"start-"+shot.index+"-"+this.getLayerIDFromName(timeline.triggerLayer),tl:tl,type:"<"})}else if(timeline.trigger==="After Layer Animation"){triggers.push({timeline:timeline,id:shot.index+"-"+this.getLayerIDFromName(layer.name),label:"end-"+shot.index+"-"+this.getLayerIDFromName(timeline.triggerLayer),tl:tl,type:"<"})}}}}}for(let key in staggers){if(staggers.hasOwnProperty(key)){let settings=staggers[key].settings;let label=staggers[key].label;label=manifest.customLabels.find(x=>x.id==label);let labelName=label!=undefined?label.name:undefined;let labelType=label!=undefined?label.labelType:"after start";let staggerDelay=label!=undefined?GetValue(label.time):0;const staggerStart=settings.staggerFrom;animation={x:"+="+settings.x,y:"+="+settings.y,ease:settings.ease,scale:settings.scale===""?undefined:settings.scale,opacity:settings.opacity,duration:GetValue(settings.duration),stagger:{from:staggerStart}};if(animation.opacity==undefined)delete animation.opacity;if(animation.scale==undefined)delete animation.scale;if(settings.customStagger!=undefined&&settings.customStagger.length>2&&settings.preset.indexOf("GSAP Expression")!=-1)animation=Object.assign(animation,JSON.parse(settings.customStagger));if(animation.duration===0)animation.duration=1e-4;delete animation.rotation;if(settings.rotationX!=undefined&&settings.rotationX!=="")animation.rotationX="+="+GetValue(settings.rotationX);if(settings.rotationY!=undefined&&settings.rotationY!=="")animation.rotationY="+="+GetValue(settings.rotationY);if(settings.rotationZ!=undefined&&settings.rotationZ!=="")animation.rotationZ="+="+GetValue(settings.rotationZ);if(settings.staggerAmountEach==="Amount")animation.stagger.amount=settings.staggerAmount;else animation.stagger.each=settings.staggerAmount;let elements=this.sortGroupElementsByOrder(staggers[key].elements,settings.name+"-order");if(settings.name==="Animate Out"||labelType=="after end"||settings.name.indexOf("ANIMOUT")!==-1){if(!isLastShot)timelines.shotOutTimeline.to(elements,animation,GetValue(settings.delay)+staggerDelay)}else if(labelType=="before end"){if(!isLastShot)timelines.beforeEndTimeline.to(elements,animation,0)}else if(settings.animationType==="from")timelines.shotTimeline.from(elements,animation,GetValue(settings.delay)+staggerDelay);else timelines.shotTimeline.to(elements,animation,GetValue(settings.delay)+staggerDelay)}}if(manifest.settings.autoPlay!==false||this.bDebugMode){this.buildTransitionTimelines(shot.index,timelines.shotTimeline)}timelines.shotTimeLineDelay="-="+timelines.shotTimeLineDelay*-1;return timelines},registerLayerEvents(){let self=this;this.layers.forEach(layer=>{let div=layer.div;if(div.hoverLayerTimelines!=undefined){div.addEventListener("mouseover",function(e){let tl=div.hoverLayerTimelines.find(x=>x.shot==this.currentShot);if(tl!=undefined){e.stopPropagation();tl.timeline.play()}}.bind(this));div.addEventListener("mouseleave",function(e){let tl=div.hoverLayerTimelines.find(x=>x.shot==this.currentShot);if(tl!=undefined){e.stopPropagation();tl.timeline.reverse()}}.bind(this))}if(div.clickLayerTimelines!=undefined){div.addEventListener(this.getClickEvent(),function(e){let tl=div.clickLayerTimelines.find(x=>x.shot==this.currentShot);if(tl!=undefined){e.stopPropagation();tl.timeline.play(0)}}.bind(this))}if(div.customEventTimelines!=undefined){div.customEventTimelines.forEach(evt=>{document.addEventListener(evt.customEvent.name,function(e){let playTimeline=false;if(e.detail.selector==undefined)playTimeline=true;else{let selectedElements=grid8player.gsapSelector(e.detail.selector);if(selectedElements.find(x=>x==div))playTimeline=true}if(playTimeline){let tl=evt.timeline;if(self.bDebugMode){if(e.detail.reverse==true){let bAdded=false;if(tl.addedTimelineTimeReversed!=undefined){let masterTime=self.timelineMaster.time();for(let i=0;i<tl.addedTimelineTimeReversed.length;i++){let diff=Math.abs(tl.addedTimelineTimeReversed[i]-masterTime);if(diff<=.2){bAdded=true;break}}}if(bAdded==false){self.timelineMaster.to(tl,tl.duration(),{time:0,ease:"none"},self.timelineMaster.time())}if(tl.addedTimelineTimeReversed==undefined)tl.addedTimelineTimeReversed=[];tl.addedTimelineTimeReversed.push(self.timelineMaster.time())}else{let bAdded=false;if(tl.addedTimelineTime!=undefined){let masterTime=self.timelineMaster.time();for(let i=0;i<tl.addedTimelineTime.length;i++){let diff=Math.abs(tl.addedTimelineTime[i]-masterTime);if(diff<=.2){bAdded=true;break}}}if(bAdded==false){self.timelineMaster.to(tl,tl.duration(),{time:tl.duration(),ease:"none"},self.timelineMaster.time())}}if(tl.addedTimelineTime==undefined)tl.addedTimelineTime=[];tl.addedTimelineTime.push(self.timelineMaster.time())}else{if(e.detail.reverse==true)tl.reverse();else if(e.detail.reset==true)tl.pause(0);else tl.play(0)}}})})}})},dispatchEvent(source,eventName,selector,details={}){const myEvent=new CustomEvent(eventName,{detail:{time:new Date,selector:selector,...details},bubbles:true});source.dispatchEvent(myEvent)},dispatchResetEvent(source,eventName,selector){this.dispatchEvent(source,eventName,selector,{reset:true})},dispatchReverseEvent(source,eventName,selector){this.dispatchEvent(source,eventName,selector,{reverse:true})},playTransitionTimeline(shotIndex){this.buildTransitionTimelines(shotIndex)},buildTransitionTimelines(shotIndex,shotTimeline){let self=this;let levelsInShot=manifest.customLevels.filter(l=>l.levelType==="transition").map(l=>l.id);let result=[];levelsInShot.forEach(levelID=>{const isFirst=shotIndex===0&&this.shotsPlayedCounter.length===0;if(manifest.settings.playFirstTransition===false&&isFirst)return;let isLinear=shotTimeline!=undefined;if(!isLinear){this.resetTransitionInTimeline(this.previousShot);this.resetTransitionOutTimeline(shotIndex)}if(this.instancedTransitions.find(t=>t.shot===shotIndex)==undefined){this.registerEmptyTransition(manifest.shots[shotIndex])}let transition=this.instancedTransitions.find(t=>t.shot===shotIndex).transition;let currentTransitionFrame=this.transitionFrames[shotIndex].find(x=>x.levelID===levelID);let previousTransitionFrame=shotIndex===0?null:this.transitionFrames[shotIndex-1].find(x=>x.levelID===levelID);if(shotTimeline==undefined&&isFirst===false){if(this.previousTransitionFrame==null)this.previousTransitionFrame=this.transitionFrames[0].find(x=>x.levelID===levelID);previousTransitionFrame=this.previousTransitionFrame}let transitionInTimeline=gsap.timeline({paused:!isLinear,onStart:()=>{this.indexWasSwapped=false;if(previousTransitionFrame!=null){let element=currentTransitionFrame.transitionFrame;let previousElement=previousTransitionFrame.transitionFrame;previousElement.insertAdjacentElement("afterend",element)}},onComplete:()=>{if(previousTransitionFrame==undefined)return;self.setHidden8(previousTransitionFrame.transitionFrame,true)}});let transitionOutTimeline=gsap.timeline({paused:!isLinear});transition.animateIn(currentTransitionFrame.transitionFrame,transitionInTimeline,{elements:currentTransitionFrame.elements,isFirst:isFirst});if(previousTransitionFrame!=undefined)transition.animateOut(previousTransitionFrame.transitionFrame,transitionOutTimeline,{elements:previousTransitionFrame.elements,isFirst:isFirst});if(!isLinear){transitionInTimeline.play(0);transitionOutTimeline.play(0);this.transitionInTimelines[this.currentShot]=transitionInTimeline;this.transitionOutTimelines[this.previousShot]=transitionOutTimeline;if(Array.isArray(this.transitionFrames))this.previousTransitionFrame=this.transitionFrames[shotIndex][0];else this.previousTransitionFrame=this.transitionFrames[shotIndex]}else{shotTimeline.add(transitionInTimeline,0);shotTimeline.add(transitionOutTimeline,0)}})},swapZIndex(elementA,elementB){let temp=elementA.style.getPropertyValue("z-index");elementA.style.zIndex=elementB.style.getPropertyValue("z-index");elementB.style.zIndex=temp},getNegativeDelay:function(shot){let shotTimeLineDelay=0;for(let i=0;i<manifest.layers.length;i++){const layer=manifest.layers[i];const shotInLayer=this.getShotInLayer(layer,shot.index);if(shotInLayer!=null){for(let t=0;t<shotInLayer.timelines.length;t++){const timeline=shotInLayer.timelines[t];for(let s=0;s<timeline.steps.length;s++){const settings=timeline.steps[s].settings;const delay=GetValue(settings.delay);if(delay<0){if(shot.index===layer.shots[0].index&&s===0){if(delay<shotTimeLineDelay)shotTimeLineDelay=delay}}}}}}return shotTimeLineDelay},initLayers:function(onComplete){this.layer=[];this.effectsToInit=[];let imagesToPreload=[];$("#ad").classList.add("ad"+manifest.settings.width+"x"+manifest.settings.height);$("#border").classList.add("ad"+manifest.settings.width+"x"+manifest.settings.height);let root=$("#ad");let self=this;const style=document.createElement("style");style.innerHTML=manifest.settings.styleSheet;document.head.appendChild(style);for(let i=0;i<manifest.layers.length;i++){let e=manifest.layers[i];let layer=undefined;if(e.name.toLowerCase()==="video-layer"){layer=document.createElement("div");layer.id="layer-"+e.guid;ad.videoHolder=layer;dashMainfestUrl=e.dashURL+"/dash/manifest.mpd";hlsManifestUrl=e.dashURL+"/hls/final.m3u8";if(e.zIndex!=undefined&&e.zIndex!=="auto"){layer.style.zIndex=e.zIndex}}else if(e.componentManifest!=undefined){layer=this.registerComponent(e)}else if(e.isGroup){layer=document.createElement("div");layer.style.zIndex=e.shots[0].zIndex;layer.setAttribute("draggable",false);if(e.zIndex!=undefined&&e.zIndex!=="auto"){layer.style.zIndex=e.zIndex}layer.id="layer-"+e.guid;if(e.isMask===true){layer.style.overflow="hidden";if(e.maskCorners!==false&&e.maskCorners!=undefined){const corners=e.maskCorners.split(",").join("px ");layer.style.borderRadius=corners+"px"}}else layer.style.overflow="visible !important"}else if(e.fileType==="text"){layer=document.createElement("div");layer.style.zIndex=e.shots[0].zIndex;if(e.zIndex!=undefined&&e.zIndex!=="auto"){layer.style.zIndex=e.zIndex}layer.id="layer-"+e.guid;layer.style.fontSize=e.fontSize+"px";layer.style.fontFamily=e.fontFamily;layer.style.color=e.fontColor;layer.style.fontWeight=fontWeight(e.fontStyle);let aliasFont=manifest.settings.webFonts.find(font=>(font.fontFamily===e.fontFamily||e.fontFamily===font.alias)&&font.fontStyle===e.fontStyle);if(aliasFont!=undefined&&aliasFont.cssFontWeight!=undefined&&aliasFont.cssFontWeight!=="")layer.style.fontWeight=aliasFont.cssFontWeight;if(aliasFont!=undefined&&aliasFont.cssFontStyle!=undefined&&aliasFont.cssFontStyle!=="")layer.style.fontStyle=aliasFont.cssFontStyle;layer.style.textAlign=e.textAlign;let lineSpacing=e.lineSpacing;if(e.originalLineSpacing==undefined)e.originalLineSpacing=e.lineSpacing;e.lineSpacing=e.originalLineSpacing;if(e.lineSpacing==undefined||e.lineSpacing===0)lineSpacing=e.fontSize;else lineSpacing=e.lineSpacing;if(e.textAnimation!=undefined&&e.textAnimation.margin){lineSpacing-=e.textAnimation.margin;e.lineSpacing=lineSpacing}e.computedLineSpacing=e.lineSpacing;layer.style.lineHeight="normal";layer.style.letterSpacing=e.fontSize/1e3*e.charSpacing+"px";if(e.underline===true){layer.style.textDecoration="underline"}if(e.strikethrough===true){layer.style.textDecoration="line-through"}layer.style.textTransform=e.textTransform;if(e.isDynamic||e.isEditable){let text=this.dynamicData[e.dynamicValue];if(text==undefined)text=e.text;if(e.fileType==="text"){if(!isNaN(e.maxCharacters)&&e.maxCharacters>0){text=truncate(text,e.maxCharacters)}if(!isNaN(e.maxLines)&&e.maxLines>0){layer.innerHTML=text.replace(/\n/g,"<br>\n");text=splitToLines(text,layer,e)}else layer.innerHTML=text}if(e.fileType==="text"){}}else{if(e.textScript==="superscript"){layer.innerHTML=`<sup>${e.text}</sup>`;layer.childNodes[0].style.fontSize=e.fontSize/1.75+"px";layer.style.marginTop="-"+e.fontSize/8+"px"}else if(e.textScript==="subscript"){layer.innerHTML=`<sub>${e.text}</sub>`;layer.childNodes[0].style.fontSize=e.fontSize/1.75+"px";layer.style.marginTop=e.fontSize/10+"px"}else layer.innerHTML=e.text.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/\n/g,"<br>")}if(e.shadow!=undefined){applyTextShadow(layer,e.shadow)}}else{let otherLayer=this.getLayerByID(e.layerImage);if(otherLayer!=undefined&&otherLayer.fileType!=undefined){if(otherLayer.fileType.toLowerCase()==="svg"&&otherLayer.svgType.toLowerCase()==="object")layer=document.createElement("object");else if(otherLayer.fileType.toLowerCase()==="svg"&&otherLayer.svgType.toLowerCase()==="inline")layer=document.createElement("div");else layer=document.createElement("img");if(otherLayer.fileType.toLowerCase()==="svg"&&otherLayer.svgType.toLowerCase()==="object")layer.data=encodeURIComponent(encodeURIComponent(otherLayer.name))+"."+otherLayer.fileType;else{if(otherLayer.imageUrl!=undefined&&otherLayer.isDynamic)layer.src=otherLayer.imageUrl;else layer.src=encodeURIComponent(encodeURIComponent(otherLayer.name))+"."+otherLayer.fileType}}else{if(e.fileType.toLowerCase()==="svg"&&e.svgType.toLowerCase()==="object")layer=document.createElement("object");else if(e.fileType.toLowerCase()==="svg"&&e.svgType.toLowerCase()==="inline"||e.fileType=="DIV")layer=document.createElement("div");else layer=document.createElement("img");if(e.isDynamic){if(e.imageUrl!=undefined)this.setImage(layer,e,e.imageUrl);else if(this.dynamicData[e.dynamicValue]==undefined){this.setImage(layer,e,encodeURIComponent(encodeURIComponent(e.name))+"."+e.fileType)}else this.setImage(layer,e,this.dynamicData[e.dynamicValue])}else if(e.isDynamic||e.isEditable){if(e.imageUrl==undefined)this.setImage(layer,e,encodeURIComponent(encodeURIComponent(e.name))+"."+e.fileType);else this.setImage(layer,e,e.imageUrl)}else this.setImage(layer,e,encodeURIComponent(encodeURIComponent(e.name))+"."+e.fileType)}layer.style.zIndex=e.shots[0].zIndex;if(e.zIndex!=undefined&&e.zIndex!=="auto"){layer.style.zIndex=e.zIndex}layer.id="layer-"+e.guid;if(e.shadow!=undefined){applyDropShadow(layer,e.shadow)}}let parent=this.getLayerByID(e.parent);let htmlName=e.name;if(parent!=undefined)htmlName=htmlName.replace("_"+parent.name,"");layer.setAttribute("name",htmlName);layer.style.mixBlendMode=e.blendMode;if(e.fileType==="text"){let realLineHeight=getLineHeight(layer);let ratio=e.lineSpacing/realLineHeight;if(ratio===0){ratio=1;e.lineSpacing=realLineHeight}let baseLineOffset=(e.lineSpacing-realLineHeight)/2;layer.style.marginTop=-baseLineOffset+"px";layer.style.lineHeight=realLineHeight*ratio+"px"}if(e.useCSSMask){let maskLayer=manifest.layers.find(x=>x.guid.includes(e.cssMask));if(maskLayer!=undefined){let maskL=maskLayer.shots[0];layer.style.maskImage=`url(${maskLayer.name}.png)`;layer.style.webkitMaskImage=`url(${maskLayer.name}.png)`;layer.style.webkitMaskRepeat="no-repeat";layer.style.maskRepeat="no-repeat";let maskPosX=maskL.pos.x-e.shots[0].pos.x;let maskPosY=maskL.pos.y-e.shots[0].pos.y;layer.style.maskPosition=layer.style.webkitMaskPosition=`${maskPosX}px ${maskPosY}px`;layer.style.maskSize=layer.style.webkitMaskSize=`${maskL.size.initW}px ${maskL.size.initH}px`;layer.style.maskRepeat="no-repeat"}}if(e.isCSSMask===true){root.appendChild(layer);layer.style.zIndex=-100;layer.style.visibility="hidden"}else if(e.parent==undefined){let layerParent=$("#level-Default");let customLevel=manifest.customLevels.find(x=>x.id===e.level);if(customLevel!=undefined){layerParent=$("#level-"+customLevel.name)}layerParent.appendChild(layer)}else if($("#layer-"+e.parent)!=undefined){$("#layer-"+e.parent).appendChild(layer)}layer.classList.add("layer-image");layer.classList.add(`shot-${e.shots[0].index}`);if(e.cssClasses!=undefined){let layerClasses=e.cssClasses.split(" ");for(let i=0;i<layerClasses.length;i++){const c=layerClasses[i].replace(".","");if(c!=undefined&&c.length>0)layer.classList.add(c)}}if(e.anchor!=undefined)layer.style.transformOrigin=e.anchor;layer.effects=[];if(e.effects!=undefined){e.effects.forEach(effect=>{layer.effects.push(this.registerEffect(layer,e,effect))})}this.setLayerInitialPosition(layer,e.shots[0],true);if(e.layoutBox==="point"){layer.style.width="auto"}else if(e.layoutBox==="autoHeight"){layer.style.height="auto"}else if(e.layoutBox==="fixedSize"){layer.style.overflow="hidden"}if(e.animateText===true){let splitType="words,lines";if(e.textAnimation.type==="chars")splitType="chars,words,lines";else if(e.textAnimation.type==="lines")splitType="lines";let setHide8=layer.parentNode&&layer.parentNode.classList.contains("hidden8");if(setHide8)layer.parentNode.classList.remove("hidden8");layer.splitText=new SplitText(layer,{type:splitType,charsClass:e.textAnimation.charsClass,wordsClass:e.textAnimation.wordsClass,linesClass:e.textAnimation.linesClass,lineThreshold:.8});if(setHide8)layer.parentNode.classList.add("hidden8");if(e.textAnimation.mask){for(let index=0;index<layer.splitText.lines.length;index++){const line=layer.splitText.lines[index];const lineClone=line.cloneNode(true);if(e.textAnimation.margin==undefined)e.textAnimation.margin="0";let margin=parseInt(e.textAnimation.margin);let height=e.lineSpacing;lineClone.className="text-mask";lineClone.style.overflow="hidden";lineClone.style.height=height+margin*2+"px";lineClone.innerHTML="";lineClone.style.top=-margin+"px";line.style.top=margin+"px";line.parentNode.appendChild(lineClone);lineClone.appendChild(line)}}}let animationElement={div:layer,shots:e.shots};if(e.fileType.toLowerCase()==="svg"&&e.svgType.toLowerCase()==="inline"){}else if(e.name.toLowerCase()!=="video-layer"&&!e.isGroup&&e.fileType!=="text"&&e.fileType!=="DIV"&&e.componentManifest==null)imagesToPreload.push(animationElement);if(e.shots[0].index!==0){layer.classList.add(`shot${e.shots[0].index}`);this.setHidden8(layer,true)}this.layers.push(animationElement)}let theShot=manifest.shots[0];if(theShot.background!=undefined){let backgroundElement=document.createElement("div");backgroundElement.id="grid8-background";gsap.set(backgroundElement,{"background-color":theShot.background,"z-index":"-99999",width:"100%",height:"100%",position:"absolute",top:"0",left:"0"});$("#ad").insertBefore(backgroundElement,$("#ad").firstChild);gsap.set($("#ad"),{"background-color":"transparent"})}if(manifest.settings.timeScale!=undefined)gsap.globalTimeline.timeScale(manifest.settings.timeScale);this.initTransitions();this.initIntersectionObserver();if(imagesToPreload.length===0)this.imagesLoaded(onComplete);else this.preloadImages(imagesToPreload,function(){grid8player.imagesLoaded(onComplete)})},initTransitions(){const self=this;this.instancedTransitions=[];this.transitionFrames=[];manifest.shots.forEach(shot=>{if(shot.transitions!=undefined&&shot.transitions.length>0){shot.transitions.forEach(transition=>{self.registerTransition(shot,transition)})}else{self.registerEmptyTransition(shot)}})},initIntersectionObserver(){const observer=new IntersectionObserver(entries=>{for(const entry of entries){const ratio=entry.intersectionRatio;const component=entry.target.component;if(component!=undefined){if(typeof component.intersect==="function")component.intersect(ratio)}const effects=entry.target.effects;if(effects!=undefined){effects.forEach(effect=>{if(typeof effect.intersect==="function")effect.intersect(ratio)})}}},{threshold:[0,.01]});this.instancedEffects.forEach(x=>{observer.observe(x)});this.instancedComponents.forEach(x=>{observer.observe(x.dom)})},setImage(element,layer,data){if(layer.fileType.toLowerCase()==="svg"&&layer.svgType.toLowerCase()==="object")element.data=data;else if(layer.fileType.toLowerCase()==="svg"&&layer.svgType.toLowerCase()==="inline"){const mySVG=layer.svgData;element.innerHTML=layer.svgData}else element.src=data},setDynamicPresetData(componentManifest,dynamicValueID){if(dynamicValueID==undefined)return;let dynamicValue=manifest.settings.dynamicValues.find(x=>x.id===dynamicValueID).name;if(dynamicValue==undefined){console.error(`Dynamic value ${dynamicValueID} not found`)}let presetName=grid8player.dynamicData[dynamicValue];let presetData=undefined;manifest.settings.presets.forEach(presetOwner=>{presetOwner.presets.forEach(preset=>{if(preset.name===presetName){presetData=preset}})});if(presetData==undefined)console.log(`Preset ${presetName} not found.`);else{componentManifest.properties=JSON.parse(JSON.stringify(presetData.properties))}},imagesLoaded(onComplete){if(!ad||ad.init==undefined)onComplete();else ad.init()},loadComponents:function(onLoaded){let self=this;let list=[];this.instancedComponents=[];for(let i=0;i<manifest.components.length;i++){let component=manifest.components[i];list.push(component.name);this.componentsToLoad++}for(let i=0;i<list.length;i++){const script=document.createElement("script");script.onload=function(){self.componentsToLoad--;if(self.componentsToLoad<=0)onLoaded()};script.src=list[i]+".js";document.head.appendChild(script)}if(self.componentsToLoad<=0)onLoaded()},registerComponent:function(e){const self=this;const componentManifest=e.componentManifest;const componentName=e.componentManifest.id;if(e.componentManifest.isDynamic===true)this.setDynamicPresetData(componentManifest,e.componentManifest.dynamicValue);const component=Object.create(grid8player.components[componentName]);let html=component.html;let styles=component.styles;if(manifest.settings.layerTypes!=undefined){let layerTypes=manifest.settings.layerTypes.layer;let dynamicValues=manifest.settings.layerTypes.dynamic;let properties=componentManifest.properties;for(const[key,value]of Object.entries(properties)){if(layerTypes.includes(key)){let theLayer=self.getLayerByID(value);if(theLayer!=undefined)properties[key]=theLayer}else if(dynamicValues.includes(key)){let dynamicValue=manifest.settings.dynamicValues.find(x=>x.id===value);let dynamicValueName=dynamicValue.name;if(dynamicValue.shotLevel===true)properties[key]=grid8player.dynamicData["s"+e.shots[0].index+"_"+dynamicValueName];else properties[key]=grid8player.dynamicData[dynamicValueName]}html=html.replaceAll("$"+key,properties[key]);styles=styles.replaceAll("$"+key,properties[key]);if(typeof properties[key]==="string"){const pattern=/\$\w+\$/g;let matches=properties[key].match(pattern);if(matches){for(let match of matches){let dynamicKey=match.slice(1,-1);if(grid8player.dynamicData.hasOwnProperty(dynamicKey)){properties[key]=properties[key].replaceAll(match,grid8player.dynamicData[dynamicKey]);html=html.replaceAll(match,grid8player.dynamicData[dynamicKey]);styles=styles.replaceAll(match,grid8player.dynamicData[dynamicKey])}}}}}}else{for(let p=0;p<componentManifest.properties.length;p++){const prop=componentManifest.properties[p];if(prop.type==="layer"&&(typeof prop.value==="string"||prop.value instanceof String))prop.value=self.getLayerByID(prop.value);html=html.replaceAll("$"+prop.name,prop.value);styles=styles.replaceAll("$"+prop.name,prop.value)}}html=html.replaceAll("$id","layer-"+e.guid);styles=styles.replaceAll("$id","layer-"+e.guid);const styleSheet=document.createElement("style");styleSheet.type="text/css";styleSheet.innerText=styles;document.head.appendChild(styleSheet);let layer=undefined;layer=document.createElement("div");layer.innerHTML=html;layer.style.zIndex=e.zIndex;component.guid=e.guid;layer.id="layer-"+e.guid;layer.style.pointerEvents="all";layer.component=component;component.init(layer,e.shots[0].pos,e.shots[0].size,componentManifest.properties,self.timelineMaster,e.shots[0].index);if(typeof component.preInit==="function")component.preInit(layer,e.shots[0].pos,e.shots[0].size,componentManifest.properties,self.timelineMaster,e.shots[0].index);if(e.useCSSMask){let maskLayer=manifest.layers.find(x=>x.guid===e.cssMask);if(maskLayer!=undefined){layer.style.maskImage=`url(${maskLayer.name}.png)`;layer.style.webkitMaskImage=`url(${maskLayer.name}.png)`;layer.style.webkitMaskRepeat="no-repeat";layer.style.maskRepeat="no-repeat"}}this.instancedComponents.push(component);return layer},loadEffects:function(onLoaded){let self=this;let list=[];this.instancedEffects=[];for(let i=0;i<manifest.effects.length;i++){let effect=manifest.effects[i];list.push(effect.name);this.effectsToLoad++}for(let i=0;i<list.length;i++){const script=document.createElement("script");script.onload=function(){self.effectsToLoad--;if(self.effectsToLoad<=0)onLoaded()};script.src=list[i]+".js";document.head.appendChild(script)}if(self.effectsToLoad<=0)onLoaded()},registerEffect:function(layer,e,efMan){const self=this;const effectManifest=efMan;const effectName=effectManifest.id;if(efMan.isDynamic===true)this.setDynamicPresetData(effectManifest,efMan.dynamicValue);const effect=Object.create(grid8player.effects[effectName]);const html=effect.html;let styles=effect.styles;if(manifest.settings.layerTypes!=undefined){let layerTypes=manifest.settings.layerTypes.layer;for(const[key,value]of Object.entries(effectManifest.properties)){if(layerTypes.includes(key)){let layer=self.getLayerByID(value);if(layer!=undefined)effectManifest.properties[key]=layer}styles=styles.replaceAll("$"+key,effectManifest.properties[key])}}else{for(let p=0;p<effectManifest.properties.length;p++){const prop=effectManifest.properties[p];if(prop.type==="layer"&&(typeof prop.value==="string"||prop.value instanceof String))prop.value=self.getLayerByID(prop.value);styles=styles.replaceAll("$"+prop.name,prop.value)}}styles=styles.replaceAll("$id","layer-"+e.guid);const styleSheet=document.createElement("style");styleSheet.type="text/css";styleSheet.innerText=styles;document.head.appendChild(styleSheet);this.effectsToInit.push([effect,layer,e.shots[0].pos,e.shots[0].size,effectManifest.properties,self.timelineMaster,e.shots[0].index]);if(typeof effect.preInit==="function")effect.preInit(layer,e.shots[0].pos,e.shots[0].size,effectManifest.properties,self.timelineMaster,e.shots[0].index);if(this.instancedEffects.indexOf(layer)===-1)this.instancedEffects.push(layer);return effect},loadTransitions:function(onLoaded){let self=this;let list=[];this.instancedTransitions=[];this.addBuildInTransition();for(let i=0;i<manifest.transitions.length;i++){let transition=manifest.transitions[i];list.push(transition.name);this.transitionsToLoad++}for(let i=0;i<list.length;i++){const script=document.createElement("script");script.onload=function(){self.transitionsToLoad--;if(self.transitionsToLoad<=0)onLoaded()};script.src=list[i]+".js";document.head.appendChild(script)}if(self.transitionsToLoad<=0)onLoaded()},addBuildInTransition(){grid8player.transitions["build-in-transition"]={manifest:{id:"simple-transition",properties:[],fonts:[],libs:[]},styles:`
      `,init(element,props,elements){this.dom=element;this.elements=elements},animateIn(element,timeline,props){if(props.firstTime===true)return;timeline.to(element,{opacity:1,duration:1e-4})},animateOut(previousElement,timeline,props){if(previousElement==null)return;timeline.to(previousElement,{opacity:0,duration:1e-4})}}},registerEmptyTransition:function(shot){const self=this;if(this.transitionFrames[shot.index]==undefined)this.transitionFrames[shot.index]=this.createTransitionFrame(shot,null)},registerEmptyTransition:function(shot){let emptyTransition={fonts:[],id:"build-in-transition",libs:[],properties:[]};this.registerTransition(shot,emptyTransition)},registerTransition:function(shot,transitionManifest){const self=this;if(this.transitionFrames[shot.index]==undefined)this.transitionFrames[shot.index]=this.createTransitionFrame(shot,transitionManifest);let transitionLevel=undefined;if(manifest.settings.layerTypes!=undefined){let levelProps=manifest.settings.layerTypes.level;if(levelProps.length>0)transitionLevel=transitionManifest.properties[levelProps[0]]}else{transitionLevel=transitionManifest.properties.find(p=>p.type==="level")}let transitionLevelID=undefined;if(transitionLevel!=undefined)transitionLevelID=transitionLevel.value;const transitionFrameIn=this.transitionFrames[shot.index].find(x=>x.levelID===transitionLevelID||transitionLevelID==undefined);let transitionFrameOut=undefined;if(transitionFrameIn==undefined)return;if(shot.index>0){transitionFrameOut=this.transitionFrames[shot.index-1].find(x=>x.levelID===transitionLevelID||transitionLevelID==undefined);if(transitionFrameOut==undefined)transitionFrameOut=this.transitionFrames[shot.index-1]=this.createTransitionFrame(manifest.shots[shot.index-1],transitionManifest)}const transitionName=transitionManifest.id;if(transitionManifest.isDynamic===true)this.setDynamicPresetData(transitionManifest,transitionManifest.dynamicValue);const transition=Object.create(grid8player.transitions[transitionName]);let styles=transition.styles;if(manifest.settings.layerTypes!=undefined){let layerTypes=manifest.settings.layerTypes.layer;for(const[key,value]of Object.entries(transitionManifest.properties)){if(layerTypes.includes(key)){transitionManifest.properties[key]=self.getLayerByID(value)}styles=styles.replaceAll("$"+key,transitionManifest.properties[key])}}else{for(var p=0;p<transitionManifest.properties.length;p++){const prop=transitionManifest.properties[p];if(prop.type==="layer")prop.value=self.getLayerByID(prop.value);styles=styles.replaceAll("$"+prop.name,prop.value)}}const styleSheet=document.createElement("style");styleSheet.type="text/css";styleSheet.innerText=styles;document.head.appendChild(styleSheet);transition.init(transitionFrameIn.transitionFrame,transitionManifest.properties,transitionFrameIn.elements,transitionFrameOut!=undefined?transitionFrameOut.transitionFrame:null,transitionFrameOut!=undefined?transitionFrameOut.elements:[]);if(this.instancedTransitions.indexOf(transitionFrameIn)===-1)this.instancedTransitions.push({shot:shot.index,transitionFrame:transitionFrameIn,transition:transition});return transition},createTransitionFrame(shot,transitionManifest){let levelsInShot=manifest.customLevels.filter(l=>l.levelType==="transition").map(l=>l.id);let result=[];levelsInShot.forEach(levelID=>{let level=manifest.customLevels.find(l=>l.id===levelID);if(level==undefined)return;let levelName=level.name;const transitionFrame=document.createElement("div");let self=this;let root=this.levels[levelID];transitionFrame.classList.add("transition-frame");root.appendChild(transitionFrame);transitionFrame.id=`transition-frame-${shot.index}-${levelName}`;transitionFrame.classList.add(`shot-${shot.index}`);self.setHidden8(transitionFrame,true);let zIndexCount=0;zIndex=0;const layersInShot=this.getLayersInShot(shot.index);const elements=layersInShot.filter(l=>l.level===levelID&&l.parent==undefined).map(l=>this.getDOMLayerByID(l.guid));elements.forEach(element=>{if(!transitionFrame.contains(element)){element.style.visibility="auto";transitionFrame.appendChild(element)}});result.push({levelName:levelName,levelID:levelID,transitionFrame:transitionFrame,elements:elements})});return result},getFontWeight:function(f){if(f.cssFontWeight!=null&&f.cssFontWeight.length>0)return f.cssFontWeight;let w=f.fontStyleUser===""||f.fontStyleUser==undefined?f.fontStyle:f.fontStyleUser;w=w.toLowerCase();if(w==="normal"||w==="bold"||w.length>0&&!isNaN(w))return w;else if(w==="semibold")return 600;else if(w==="regular")return"normal";else return"normal"},getFontStyle:function(f){if(f.cssFontStyle!=null&&f.cssFontStyle.length>0)return f.cssFontStyle;return"normal"},loadFonts:function(onComplete){let count=0;if(manifest.settings.useWebFonts===false){onComplete();return}const fonts=[];if(manifest.settings.webFonts.length===0){onComplete();return}self.webFontsToLoad=manifest.settings.webFonts.filter(x=>x.fontUrl.length>0&&!x.isDeleted);if(self.webFontsToLoad.length===0)onComplete();for(let i=0;i<self.webFontsToLoad.length;i++){const f=self.webFontsToLoad[i];const newFont=new FontFace(f.fontFamilyUser===""||f.fontFamilyUser==undefined?f.fontFamily:f.fontFamilyUser,`url(${f.fontUrl})`,{weight:this.getFontWeight(f),style:this.getFontStyle(f)});fonts.push(newFont);newFont.load().then(function(loadedFont){document.fonts.add(loadedFont);console.log(loadedFont.family,loadedFont.weight,loadedFont.style," font loaded");count++;if(count>=self.webFontsToLoad.length)onComplete()}).catch(function(error){count++;if(count>=self.webFontsToLoad.length)onComplete();console.error("Failed to load font: "+error)})}},animationLoaded:function(){$("#ad").style.visibility="visible";$("#border").style.visibility="visible";for(let i=0;i<this.layers.length;i++){if(this.layers[i].shots[0].size.w==undefined){this.layers[i].div.width/=2}}this.effectsToInit.forEach(effect=>{effect[0].init(effect[1],effect[2],effect[3],effect[4],effect[5],effect[6])});this.playAllShots();gsap.delayedCall(1,function(){window.ready=true})},replay:function(){this.timelineMaster.play(0)},reset:function(){},play:function(){if(this.timelineMaster!=null){this.timelineMaster.play(0);this.onShotStart(manifest.shots[0])}},resume:function(){this.timelineMaster.resume()},pause:function(){this.timelineMaster.pause()},seek(t){this.timelineMaster.seek(t,grid8player.suppressEvents)},gotoAndStop(t){this.updateDebugProgress(t/this.duration);this.timelineMaster.pause(t,grid8player.suppressEvents)},gotoAndPlay(t){this.updateDebugProgress(t/this.duration);this.timelineMaster.play(t,grid8player.suppressEvents)},setTimeScale(s){this.timelineMaster.timeScale(s)},playAllShots:function(){},getPreset:function(pname){if(manifest.customPresets==undefined)return undefined;let preset=null;manifest.customPresets.forEach(p=>{if(p.name===pname){preset=p;return preset}});return preset},getAnimationGroup:function(groupName){if(manifest.animationGroups==undefined)return undefined;for(let index=0;index<manifest.animationGroups.length;index++){const animationGroup=manifest.animationGroups[index];if(groupName===animationGroup.id){return animationGroup}}return undefined},isAnimationGroup(a){if(a==undefined)return false;if(manifest.customPresets!=undefined){for(let index=0;index<manifest.customPresets.length;index++){const preset=manifest.customPresets[index];if(a.preset===preset.name){return false}}}let presets=["Manual","Fade","ScaleFrom","ScaleTo","Drop","⭣","⭡","⭢","⭠","Shake","Pop","Wiggle"];if(a!=undefined&&a.preset!=undefined&&presets.indexOf(a.preset)===-1)return true;return false},onComplete:function(){this.bMasterTimelineCompleted=true},onClick:function(){},onSwipe:function(direction){if(direction!=="tap")this.timelineSwipe[direction.type].play(0);else window.onClick();for(let index=0;index<this.instancedComponents.length;index++){const component=this.instancedComponents[index];if(typeof component.onSwipe==="function")component.onSwipe(direction)}},enableMouseOver:function(){this.bMasterTimelineCompleted=this.mouseOverEnabled=true},onHoverComplete:function(){this.bHoverTimelineCompleted=true},onMouseOver:function(event,obj){if(manifest.settings.autoPlay===false&&this.mouseOverEnabled===true||this.bMasterTimelineCompleted===true&&manifest.settings.autoPlay!==false){this.bHoverTimelineCompleted=false;this.timelineHover.play(0);for(let index=0;index<this.instancedComponents.length;index++){const component=this.instancedComponents[index];if(typeof component.onMouseOver==="function")component.onMouseOver()}for(let index=0;index<this.instancedEffects.length;index++){const effects=this.instancedEffects[index].effects;effects.forEach(effect=>{if(typeof effect.onMouseOver==="function")effect.onMouseOver()})}return 0}},onMouseOut:function(){if(manifest.settings.autoPlay===false&&this.mouseOverEnabled===true||this.bMasterTimelineCompleted===true&&manifest.settings.autoPlay!==false){this.timelineHover.reverse();for(let index=0;index<this.instancedComponents.length;index++){const component=this.instancedComponents[index];if(typeof component.onMouseOut==="function")component.onMouseOut()}for(let index=0;index<this.instancedEffects.length;index++){const effects=this.instancedEffects[index].effects;effects.forEach(effect=>{if(typeof effect.onMouseOut==="function")effect.onMouseOut()})}return 0}},getAllDOMLayers:function(){let arr={};for(let l=0;l<manifest.layers.length;l++){let layer=manifest.layers[l];arr[layer.name]=this.getDOMLayerFromName(layer.name)}return arr},getLayer(layerID){return this.getLayerByID(layerID)},getLayerByID:function(layerID){if(layerID==undefined)return undefined;for(let l=0;l<manifest.layers.length;l++){let layer=manifest.layers[l];if(layer.guid===layerID)return layer}return undefined},getDOMLayerByID:function(layerID){return $("#layer-"+layerID)},getDOMLayerFromName:function(n){let layerID=this.getLayerIDFromName(n);return $("#layer-"+layerID)},getLayerFromDOMID(domID){let layerID=domID.replace("layer-","");let layer=manifest.layers.find(x=>x.guid===layerID);return layer},getLayerIDFromName:function(layerName){for(let l=0;l<manifest.layers.length;l++)if(manifest.layers[l].name===layerName)return manifest.layers[l].guid;return null},getShot:function(shots,index){for(let s=0;s<shots.length;s++)if(shots[s].index===index)return shots[s];return null},getLayersInShot(shotIndex){let l=[];manifest.layers.forEach(layer=>{let shotInLayer=this.getShotInLayer(layer,shotIndex);if(shotInLayer!=undefined)l.push(layer)});return l},getShotInLayer:function(layer,shotIndex){for(let s=0;s<layer.shots.length;s++){if(layer.shots[s].index===shotIndex)return layer.shots[s]}return null},sortGroupElementsByOrder(elements,orderID){return elements.sort(function(elementA,elementB){let a=GetValue(elementA[orderID]);let b=GetValue(elementB[orderID]);return a-b})},hideMissingImages:function(){var allimgs=document.images;for(var i=0;i<allimgs.length;i++){let img=allimgs[i];if(img.naturalWidth==0||img.naturalHeight==0){img.style.visibility="hidden"}}},preloadImages:function(layers,callback){let img;if(layers.length===0){callback();return}let remaining=layers.length;for(let i=0;i<layers.length;i++){if(layers[i]){img=new Image;let l=layers[i];img.onload=function(){if(l.div.src==undefined||l.div.src===""){--remaining;if(remaining<=0){callback()}}else{--remaining;if(remaining<=0){callback()}}};img.onerror=function(){--remaining;if(remaining<=0){callback()}};if(layers[i].div.src==undefined||layers[i].div.src==="")img.src=""+layers[i].div.data;else{img.src=""+layers[i].div.src;layers[i].div.width=""+layers[i].shots[0].size.initW;layers[i].div.height=""+layers[i].shots[0].size.initH}}}},onResize(){let scaleX=Math.ceil(document.documentElement.clientWidth)/manifest.settings.width,scaleY=Math.ceil(document.documentElement.clientHeight)/manifest.settings.height;function scaleContent(x,y=x){document.getElementById("ad").style.transform="scale("+x+","+y+")"}switch(manifest.settings.stretchAd){case"Horizontal":scaleContent(scaleX);break;case"Vertical":scaleContent(scaleY);break;case"Fill":case"Both":scaleContent(scaleX,scaleY);break;case"Auto":case"Contain":scaleContent(Math.min(scaleX,scaleY));break;case"Cover":scaleContent(Math.max(scaleX,scaleY));break;case"Responsive":$("#ad").style.setProperty("width","100vw");$("#ad").style.setProperty("height","100vh");$("#border").style.setProperty("width","100vw");$("#border").style.setProperty("height","100vh");break}},resetTransitionInTimeline(index){if(this.transitionInTimelines[index]!=undefined){this.transitionInTimelines[index].progress(1)}},resetTransitionOutTimeline(index){if(this.transitionOutTimelines[index]!=undefined){this.transitionOutTimelines[index].revert()}},resetShot(index){for(let l=0;l<manifest.layers.length;l++){let layer=manifest.layers[l];let shot=layer.shots[0];if(layer.shots[0].index!==index)continue;let domLayer=this.getDOMLayerFromName(layer.name);gsap.killTweensOf(domLayer);gsap.set(domLayer,{x:shot.pos.x,y:shot.pos.y,rotationZ:shot.rotation??0,rotationX:shot.rotationX??0,rotationY:shot.rotationY??0,width:shot.size.initW,height:shot.size.initH,opacity:shot.opacity})}},debug(bShow=true){manifest.settings.autoPlay=true;let self=this;this.bDebugMode=bShow;self.init(function(){self.duration=self.timelineMaster.totalDuration();for(let l=0;l<manifest.layers.length;l++){let e=manifest.layers[l];let domLayer=self.getDOMLayerFromName(e.name);if(domLayer==undefined)continue;if(e.layoutBox==="point"){domLayer.style.width="auto"}else if(e.layoutBox==="autoHeight"){domLayer.style.height="auto"}else if(e.layoutBox==="fixedSize"){domLayer.style.overflow="hidden"}}const markerWrapper=document.createElement("div");markerWrapper.className="label-marker-wrapper";$("#slider-wrapper").appendChild(markerWrapper);for(let index=0;index<manifest.shots.length;index++){const labelT=grid8player.timelineMaster.labels[`shot${index}`];const newMarker=document.createElement("div");newMarker.className="label-marker";markerWrapper.appendChild(newMarker);newMarker.style.left=`${labelT/grid8player.timelineMaster.totalDuration()*100}%`}let backButton=document.querySelector("#debug-back");let playButton=document.querySelector("#debug-play");let forwardButton=document.querySelector("#debug-forward");let playIcon=document.querySelector("#play-debug-icon");let pauseIcon=document.querySelector("#pause-debug-icon");self.timelineMaster.pause(0);playButton.onclick=function(){if(!self.timelineMaster.isActive()){self.timelineMaster.play();playIcon.style.display="none";pauseIcon.style.display="initial";self.bDebugButton="pause"}else{playIcon.style.display="initial";pauseIcon.style.display="none";self.bDebugButton="play";self.timelineMaster.pause()}};backButton.onclick=function(){let nextFrame=self.currentShot-1;if(nextFrame<0)return;if(self.bDebugButton==="play"){self.timelineMaster.pause(`shot${nextFrame}`);self.onUpdate()}else self.timelineMaster.play(`shot${nextFrame}`);self.currentShot=nextFrame};forwardButton.onclick=function(){let nextFrame=self.currentShot+1;if(nextFrame>=manifest.shots.length)return;if(self.bDebugButton==="play"){self.timelineMaster.pause(`shot${nextFrame}`);self.onUpdate()}else self.timelineMaster.play(`shot${nextFrame}`);self.currentShot=nextFrame};let grid8Mode=grid8player.dynamicData["grid8"]=="true";grid8player.onShotStart(manifest.shots[self.currentShot]);if(bShow===false||grid8Mode){$("#debug-panel").style.display="none";$("#debug-slider").removeEventListener("input",self.onDebugChange);self.timelineMaster.pause(0);grid8player.gotoAndStop(1e-4);return}grid8player.gotoAndStop(1e-4);$("#debug-panel").style.display="block";$("#debug-slider").addEventListener("input",self.onDebugChange);$("#debug-label").innerHTML=0..toFixed(2)+" / "+self.duration.toFixed(2)})},onUpdate(){let self=grid8player;if(self.bDebugMode){if(self.progressBar==undefined)self.progressBar=document.querySelector("#debug-slider");let timeline=self.timelineMaster;self.progressBar.value=timeline.progress()*100;$("#debug-label").innerHTML=timeline.time().toFixed(2)+" / "+self.duration.toFixed(2)}},getClickEvent(){return"pointerup"},getExitUrl(){let dynamicExitURL=this.checkForExitUrlKey(this.dynamicData);if(dynamicExitURL!=undefined){return dynamicExitURL}let shot=manifest.shots[this.currentShot];if(shot.autoExitURL===false)return shot.customExitURL;return manifest.settings.exitUrl||""},checkForExitUrlKey(object){const regex=/exit\s*url/i;for(const key in object){const normalizedKey=key.replace(/[_.-]/g," ");if(regex.test(normalizedKey)){return object[key]}}return undefined},onDebugChange(e){let progress=parseFloat(e.target.value)/100;grid8player.updateDebugProgress(progress)},updateDebugProgress(progress){let self=grid8player;const currentShotIndex=self.currentShot;if(self.bDebugButton==="play")self.timelineMaster.seek(progress*self.duration,self.suppressEvents);else self.timelineMaster.play(progress*self.duration);$("#debug-label").innerHTML=(progress*self.duration).toFixed(2)+" / "+self.duration.toFixed(2);const time=self.timelineMaster.time();for(let index=0;index<manifest.shots.length;index++){const labelT=grid8player.timelineMaster.labels[`shot${index}`];if(time>labelT){self.currentShot=index}}if(self.currentShot!==currentShotIndex){self.onShotChange(manifest.shots[self.currentShot])}}};function $(nameID){const t=nameID[0];nameID=nameID.substr(1);if(t==="#")return document.getElementById(nameID);else if(t===".")return document.getElementsByClassName(nameID)}function getTranslateXY(layer){const style=window.getComputedStyle(layer);const matrix=new DOMMatrixReadOnly(style.transform);return{x:matrix.m41,y:matrix.m42}}function getRotation(layer){const rotateX=gsap.getProperty(layer,"rotationX");rotateY=gsap.getProperty(layer,"rotationY");rotateZ=gsap.getProperty(layer,"rotationZ");return{x:rotateX,y:rotateY,z:rotateZ}}function applyTextShadow(layer,shadow){let{r,g,b,a}=shadow.color;layer.style.textShadow=`${shadow.x}px ${shadow.y}px ${shadow.blur}px rgba(${r},${g},${b},${a/256})`}function applyDropShadow(layer,shadow){let{r,g,b,a}=shadow.color;layer.style.filter=`drop-shadow(${shadow.x}px ${shadow.y}px ${shadow.blur}px rgba(${r},${g},${b},${a/256}))`}function GetValue(val){if(val==undefined||val==="")return 0;const sVal=val+"";if(sVal.indexOf("/")===-1)return parseFloat(val+"");const values=val.split("/");const r=randomIntFromInterval(parseFloat(values[0]),parseFloat(values[1]));return parseFloat(r+"")}function randomIntFromInterval(min,max){return Math.random()*(max-min)+min}function truncate(input,maxSize){if(input.length>maxSize){return input.substr(0,maxSize-3)+"..."}return input}function splitToLines(text,dom,layer){setMaxLinesStyle(dom,parseInt(layer.maxLines));return;let words=text.split(" ");let line="";let maxHeight=layer.fontSize*parseInt(layer.maxLines);const clone=dom.cloneNode(true);clone.style.width=layer.shots[0].size.initW+"px",document.body.appendChild(clone);while(words.length>0){let word=words.shift();clone.innerHTML=line+word+"...";let rect=clone.getBoundingClientRect();if(rect.height>maxHeight){line=line.slice(0,-4);clone.remove();return line+"..."}line+=word+" "}clone.remove();return line}function setMaxLinesStyle(domElement,maxLines){if(!domElement){console.warn("domElement is not provided");return}if(!maxLines){console.warn("maxLines is not provided");return}domElement.style.overflow="hidden";domElement.style.display="-webkit-box";domElement.style["-webkit-line-clamp"]=maxLines;domElement.style.lineClamp=maxLines;domElement.style["-webkit-box-orient"]="vertical";domElement.style.textOverflow="ellipsis";domElement.style.wordWrap="break-word"}let AdobeAn;!function(D,u){"object"==typeof exports&&"undefined"!=typeof module?u(exports):"function"==typeof define&&define.amd?define(["exports"],u):u((D=D||self).window=D.window||{})}(this,function(D){"use strict";const _=/([\uD800-\uDBFF][\uDC00-\uDFFF](?:[\u200D\uFE0F][\uD800-\uDBFF][\uDC00-\uDFFF]){2,}|\uD83D\uDC69(?:\u200D(?:(?:\uD83D\uDC69\u200D)?\uD83D\uDC67|(?:\uD83D\uDC69\u200D)?\uD83D\uDC66)|\uD83C[\uDFFB-\uDFFF])|\uD83D\uDC69\u200D(?:\uD83D\uDC69\u200D)?\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC69\u200D(?:\uD83D\uDC69\u200D)?\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67])|\uD83C\uDFF3\uFE0F\u200D\uD83C\uDF08|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD37-\uDD39\uDD3D\uDD3E\uDDD6-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]\uFE0F|\uD83D\uDC69(?:\uD83C[\uDFFB-\uDFFF])\u200D(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92])|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC6F\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD37-\uDD39\uDD3C-\uDD3E\uDDD6-\uDDDF])\u200D[\u2640\u2642]\uFE0F|\uD83C\uDDFD\uD83C\uDDF0|\uD83C\uDDF6\uD83C\uDDE6|\uD83C\uDDF4\uD83C\uDDF2|\uD83C\uDDE9(?:\uD83C[\uDDEA\uDDEC\uDDEF\uDDF0\uDDF2\uDDF4\uDDFF])|\uD83C\uDDF7(?:\uD83C[\uDDEA\uDDF4\uDDF8\uDDFA\uDDFC])|\uD83C\uDDE8(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDEE\uDDF0-\uDDF5\uDDF7\uDDFA-\uDDFF])|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uFE0F\u200D[\u2640\u2642]|(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642])\uFE0F|(?:\uD83D\uDC41\uFE0F\u200D\uD83D\uDDE8|\uD83D\uDC69(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2695\u2696\u2708]|\uD83D\uDC69\u200D[\u2695\u2696\u2708]|\uD83D\uDC68(?:(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708]))\uFE0F|\uD83C\uDDF2(?:\uD83C[\uDDE6\uDDE8-\uDDED\uDDF0-\uDDFF])|\uD83D\uDC69\u200D(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\u2764\uFE0F\u200D(?:\uD83D\uDC8B\u200D(?:\uD83D[\uDC68\uDC69])|\uD83D[\uDC68\uDC69]))|\uD83C\uDDF1(?:\uD83C[\uDDE6-\uDDE8\uDDEE\uDDF0\uDDF7-\uDDFB\uDDFE])|\uD83C\uDDEF(?:\uD83C[\uDDEA\uDDF2\uDDF4\uDDF5])|\uD83C\uDDED(?:\uD83C[\uDDF0\uDDF2\uDDF3\uDDF7\uDDF9\uDDFA])|\uD83C\uDDEB(?:\uD83C[\uDDEE-\uDDF0\uDDF2\uDDF4\uDDF7])|[#\*0-9]\uFE0F\u20E3|\uD83C\uDDE7(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEF\uDDF1-\uDDF4\uDDF6-\uDDF9\uDDFB\uDDFC\uDDFE\uDDFF])|\uD83C\uDDE6(?:\uD83C[\uDDE8-\uDDEC\uDDEE\uDDF1\uDDF2\uDDF4\uDDF6-\uDDFA\uDDFC\uDDFD\uDDFF])|\uD83C\uDDFF(?:\uD83C[\uDDE6\uDDF2\uDDFC])|\uD83C\uDDF5(?:\uD83C[\uDDE6\uDDEA-\uDDED\uDDF0-\uDDF3\uDDF7-\uDDF9\uDDFC\uDDFE])|\uD83C\uDDFB(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDEE\uDDF3\uDDFA])|\uD83C\uDDF3(?:\uD83C[\uDDE6\uDDE8\uDDEA-\uDDEC\uDDEE\uDDF1\uDDF4\uDDF5\uDDF7\uDDFA\uDDFF])|\uD83C\uDFF4\uDB40\uDC67\uDB40\uDC62(?:\uDB40\uDC77\uDB40\uDC6C\uDB40\uDC73|\uDB40\uDC73\uDB40\uDC63\uDB40\uDC74|\uDB40\uDC65\uDB40\uDC6E\uDB40\uDC67)\uDB40\uDC7F|\uD83D\uDC68(?:\u200D(?:\u2764\uFE0F\u200D(?:\uD83D\uDC8B\u200D)?\uD83D\uDC68|(?:(?:\uD83D[\uDC68\uDC69])\u200D)?\uD83D\uDC66\u200D\uD83D\uDC66|(?:(?:\uD83D[\uDC68\uDC69])\u200D)?\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92])|(?:\uD83C[\uDFFB-\uDFFF])\u200D(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]))|\uD83C\uDDF8(?:\uD83C[\uDDE6-\uDDEA\uDDEC-\uDDF4\uDDF7-\uDDF9\uDDFB\uDDFD-\uDDFF])|\uD83C\uDDF0(?:\uD83C[\uDDEA\uDDEC-\uDDEE\uDDF2\uDDF3\uDDF5\uDDF7\uDDFC\uDDFE\uDDFF])|\uD83C\uDDFE(?:\uD83C[\uDDEA\uDDF9])|\uD83C\uDDEE(?:\uD83C[\uDDE8-\uDDEA\uDDF1-\uDDF4\uDDF6-\uDDF9])|\uD83C\uDDF9(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDED\uDDEF-\uDDF4\uDDF7\uDDF9\uDDFB\uDDFC\uDDFF])|\uD83C\uDDEC(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEE\uDDF1-\uDDF3\uDDF5-\uDDFA\uDDFC\uDDFE])|\uD83C\uDDFA(?:\uD83C[\uDDE6\uDDEC\uDDF2\uDDF3\uDDF8\uDDFE\uDDFF])|\uD83C\uDDEA(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDED\uDDF7-\uDDFA])|\uD83C\uDDFC(?:\uD83C[\uDDEB\uDDF8])|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uD83C[\uDFFB-\uDFFF])|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD37-\uDD39\uDD3D\uDD3E\uDDD6-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])|(?:[\u261D\u270A-\u270D]|\uD83C[\uDF85\uDFC2\uDFC7]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66\uDC67\uDC70\uDC72\uDC74-\uDC76\uDC78\uDC7C\uDC83\uDC85\uDCAA\uDD74\uDD7A\uDD90\uDD95\uDD96\uDE4C\uDE4F\uDEC0\uDECC]|\uD83E[\uDD18-\uDD1C\uDD1E\uDD1F\uDD30-\uDD36\uDDD1-\uDDD5])(?:\uD83C[\uDFFB-\uDFFF])|\uD83D\uDC68(?:\u200D(?:(?:(?:\uD83D[\uDC68\uDC69])\u200D)?\uD83D\uDC67|(?:(?:\uD83D[\uDC68\uDC69])\u200D)?\uD83D\uDC66)|\uD83C[\uDFFB-\uDFFF])|(?:[\u261D\u26F9\u270A-\u270D]|\uD83C[\uDF85\uDFC2-\uDFC4\uDFC7\uDFCA-\uDFCC]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66-\uDC69\uDC6E\uDC70-\uDC78\uDC7C\uDC81-\uDC83\uDC85-\uDC87\uDCAA\uDD74\uDD75\uDD7A\uDD90\uDD95\uDD96\uDE45-\uDE47\uDE4B-\uDE4F\uDEA3\uDEB4-\uDEB6\uDEC0\uDECC]|\uD83E[\uDD18-\uDD1C\uDD1E\uDD1F\uDD26\uDD30-\uDD39\uDD3D\uDD3E\uDDD1-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])?|(?:[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u270A\u270B\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55]|\uD83C[\uDC04\uDCCF\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF7C\uDF7E-\uDF93\uDFA0-\uDFCA\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF4\uDFF8-\uDFFF]|\uD83D[\uDC00-\uDC3E\uDC40\uDC42-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDD7A\uDD95\uDD96\uDDA4\uDDFB-\uDE4F\uDE80-\uDEC5\uDECC\uDED0-\uDED2\uDEEB\uDEEC\uDEF4-\uDEF8]|\uD83E[\uDD10-\uDD3A\uDD3C-\uDD3E\uDD40-\uDD45\uDD47-\uDD4C\uDD50-\uDD6B\uDD80-\uDD97\uDDC0\uDDD0-\uDDE6])|(?:[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267B\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD7A\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA4\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED2\uDEE0-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3-\uDEF8]|\uD83E[\uDD10-\uDD3A\uDD3C-\uDD3E\uDD40-\uDD45\uDD47-\uDD4C\uDD50-\uDD6B\uDD80-\uDD97\uDDC0\uDDD0-\uDDE6])\uFE0F)/;function k(D){return e.getComputedStyle(D)}function n(D,u){let e;return i(D)?D:"string"===(e=typeof D)&&!u&&D?E.call(X.querySelectorAll(D),0):D&&"object"===e&&"length"in D?E.call(D,0):D?[D]:[]}function o(D){return"absolute"===D.position||!0===D.absolute}function p(D,u){let e,t=u.length;for(;-1<--t;)if(e=u[t],D.substr(0,e.length)===e)return e.length}function r(D,u){void 0===D&&(D="");const e=~D.indexOf("++");let t=1;return e&&(D=D.split("++").join("")),function(){return"<"+u+" style='position:relative;display:inline-block;'"+(D?" class='"+D+(e?t++:"")+"'>":">")}}function s(D,u,e){const t=D.nodeType;if(1===t||9===t||11===t)for(D=D.firstChild;D;D=D.nextSibling)s(D,u,e);else 3!==t&&4!==t||(D.nodeValue=D.nodeValue.split(u).join(e))}function t(D,u){for(let e=u.length;-1<--e;)D.push(u[e])}function u(D,u,e){for(let t;D&&D!==u;){if(t=D._next||D.nextSibling)return t.textContent.charAt(0)===e;D=D.parentNode||D._parent}}function v(D){let u,e;const t=n(D.childNodes),F=t.length;for(u=0;u<F;u++)(e=t[u])._isSplit?v(e):u&&e.previousSibling&&3===e.previousSibling.nodeType?(e.previousSibling.nodeValue+=3===e.nodeType?e.nodeValue:e.firstChild.nodeValue,D.removeChild(e)):3!==e.nodeType&&(D.insertBefore(e.firstChild,e),D.removeChild(e))}function w(D,u){return parseFloat(u[D])||0}function x(D,e,F,C,i,n,E){let r,l,p,d,a,h,B,f,A,c,x,g;const y=k(D),_=w("paddingLeft",y);let b=-999;const S=w("borderBottomWidth",y)+w("borderTopWidth",y),T=w("borderLeftWidth",y)+w("borderRightWidth",y),m=w("paddingTop",y)+w("paddingBottom",y),N=w("paddingLeft",y)+w("paddingRight",y),L=w("fontSize",y)*(e.lineThreshold||.2),W=y.textAlign,H=[],O=[],V=[],j=e.wordDelimiter||" ",M=e.tag?e.tag:e.span?"span":"div",R=e.type||e.split||"chars,words,lines",z=i&&~R.indexOf("lines")?[]:null,P=~R.indexOf("words"),q=~R.indexOf("chars"),G=o(e);let I=e.linesClass;const J=~(I||"").indexOf("++"),K=[],Q="flex"===y.display,U=D.style.display;for(J&&(I=I.split("++").join("")),Q&&(D.style.display="block"),p=(l=D.getElementsByTagName("*")).length,a=[],r=0;r<p;r++)a[r]=l[r];if(z||G)for(r=0;r<p;r++)((h=(d=a[r]).parentNode===D)||G||q&&!P)&&(g=d.offsetTop,z&&h&&Math.abs(g-b)>L&&("BR"!==d.nodeName||0===r)&&(B=[],z.push(B),b=g),G&&(d._x=d.offsetLeft,d._y=g,d._w=d.offsetWidth,d._h=d.offsetHeight),z&&((d._isSplit&&h||!q&&h||P&&h||!P&&d.parentNode.parentNode===D&&!d.parentNode._isSplit)&&(B.push(d),d._x-=_,u(d,D,j)&&(d._wordEnd=!0)),"BR"===d.nodeName&&(d.nextSibling&&"BR"===d.nextSibling.nodeName||0===r)&&z.push([])));for(r=0;r<p;r++)if(h=(d=a[r]).parentNode===D,"BR"!==d.nodeName)if(G&&(A=d.style,P||h||(d._x+=d.parentNode._x,d._y+=d.parentNode._y),A.left=d._x+"px",A.top=d._y+"px",A.position="absolute",A.display="block",A.width=d._w+1+"px",A.height=d._h+"px"),!P&&q)if(d._isSplit)for(d._next=l=d.nextSibling,d.parentNode.appendChild(d);l&&3===l.nodeType&&" "===l.textContent;)d._next=l.nextSibling,d.parentNode.appendChild(l),l=l.nextSibling;else d.parentNode._isSplit?(d._parent=d.parentNode,!d.previousSibling&&d.firstChild&&(d.firstChild._isFirst=!0),d.nextSibling&&" "===d.nextSibling.textContent&&!d.nextSibling.nextSibling&&K.push(d.nextSibling),d._next=d.nextSibling&&d.nextSibling._isFirst?null:d.nextSibling,d.parentNode.removeChild(d),a.splice(r--,1),p--):h||(g=!d.nextSibling&&u(d.parentNode,D,j),d.parentNode._parent&&d.parentNode._parent.appendChild(d),g&&d.parentNode.appendChild(X.createTextNode(" ")),"span"===M&&(d.style.display="inline"),H.push(d));else d.parentNode._isSplit&&!d._isSplit&&""!==d.innerHTML?O.push(d):q&&!d._isSplit&&("span"===M&&(d.style.display="inline"),H.push(d));else z||G?(d.parentNode&&d.parentNode.removeChild(d),a.splice(r--,1),p--):P||D.appendChild(d);for(r=K.length;-1<--r;)K[r].parentNode.removeChild(K[r]);if(z){for(G&&(c=X.createElement(M),D.appendChild(c),x=c.offsetWidth+"px",g=c.offsetParent===D?0:D.offsetLeft,D.removeChild(c)),A=D.style.cssText,D.style.cssText="display:none;";D.firstChild;)D.removeChild(D.firstChild);for(f=" "===j&&(!G||!P&&!q),r=0;r<z.length;r++){for(B=z[r],(c=X.createElement(M)).style.cssText="display:block;text-align:"+W+";position:"+(G?"absolute;":"relative;"),I&&(c.className=I+(J?r+1:"")),V.push(c),p=B.length,l=0;l<p;l++)"BR"!==B[l].nodeName&&(d=B[l],c.appendChild(d),f&&d._wordEnd&&c.appendChild(X.createTextNode(" ")),G&&(0===l&&(c.style.top=d._y+"px",c.style.left=_+g+"px"),d.style.top="0px",g&&(d.style.left=d._x-g+"px")));0===p?c.innerHTML="&nbsp;":P||q||(v(c),s(c,String.fromCharCode(160)," ")),G&&(c.style.width=x,c.style.height=d._h+"px"),D.appendChild(c)}D.style.cssText=A}G&&(E>D.clientHeight&&(D.style.height=E-m+"px",D.clientHeight<E&&(D.style.height=E+S+"px")),n>D.clientWidth&&(D.style.width=n-N+"px",D.clientWidth<n&&(D.style.width=n+T+"px"))),Q&&(U?D.style.display=U:D.style.removeProperty("display")),t(F,H),P&&t(C,O),t(i,V)}function y(D,u,e,t){let F,C,i,n,E,r,l,d;const a=u.tag?u.tag:u.span?"span":"div",h=~(u.type||u.split||"chars,words,lines").indexOf("chars"),B=o(u),f=u.wordDelimiter||" ",A=" "!==f?"":B?"&#173; ":" ",c="</"+a+">";let x=1;const g=u.specialChars?"function"==typeof u.specialChars?u.specialChars:p:null,y=X.createElement("div"),v=D.parentNode;for(v.insertBefore(y,D),y.textContent=D.nodeValue,v.removeChild(D),l=-1!==(F=function getText(D){const u=D.nodeType;let e="";if(1===u||9===u||11===u){if("string"==typeof D.textContent)return D.textContent;for(D=D.firstChild;D;D=D.nextSibling)e+=getText(D)}else if(3===u||4===u)return D.nodeValue;return e}(D=y)).indexOf("<"),!1!==u.reduceWhiteSpace&&(F=F.replace(S," ").replace(b,"")),l&&(F=F.split("<").join("{{LT}}")),E=F.length,C=(" "===F.charAt(0)?A:"")+e(),i=0;i<E;i++)if(r=F.charAt(i),g&&(d=g(F.substr(i),u.specialChars)))r=F.substr(i,d||1),C+=h&&" "!==r?t()+r+"</"+a+">":r,i+=d-1;else if(r===f&&F.charAt(i-1)!==f&&i){for(C+=x?c:"",x=0;F.charAt(i+1)===f;)C+=A,i++;i===E-1?C+=A:")"!==F.charAt(i+1)&&(C+=A+e(),x=1)}else"{"===r&&"{{LT}}"===F.substr(i,6)?(C+=h?t()+"{{LT}}</"+a+">":"{{LT}}",i+=5):55296<=r.charCodeAt(0)&&r.charCodeAt(0)<=56319||65024<=F.charCodeAt(i+1)&&F.charCodeAt(i+1)<=65039?(n=((F.substr(i,12).split(_)||[])[1]||"").length||2,C+=h&&" "!==r?t()+F.substr(i,n)+"</"+a+">":F.substr(i,n),i+=n-1):C+=h&&" "!==r?t()+r+"</"+a+">":r;D.outerHTML=C+(x?c:""),l&&s(v,"{{LT}}","<")}function z(D,u,e,t){let F,C;const i=n(D.childNodes),E=i.length,s=o(u);if(3!==D.nodeType||1<E){for(u.absolute=!1,F=0;F<E;F++)(C=i[F])._next=C._isFirst=C._parent=C._wordEnd=null,3===C.nodeType&&!/\S+/.test(C.nodeValue)||(s&&3!==C.nodeType&&"inline"===k(C).display&&(C.style.display="inline-block",C.style.position="relative"),C._isSplit=!0,z(C,u,e,t));return u.absolute=s,void(D._isSplit=!0)}y(D,u,e,t)}var X,e,F,C,b=/(?:\r|\n|\t\t)/g,S=/(?:\s\s+)/g,i=Array.isArray,E=[].slice,l=((C=SplitText.prototype).split=function split(D){this.isSplit&&this.revert(),this.vars=D=D||this.vars,this._originals.length=this.chars.length=this.words.length=this.lines.length=0;let u,e,t,F=this.elements.length;const C=D.tag?D.tag:D.span?"span":"div",i=r(D.wordsClass,C),n=r(D.charsClass,C);for(;-1<--F;)t=this.elements[F],this._originals[F]=t.innerHTML,u=t.clientHeight,e=t.clientWidth,z(t,D,i,n),x(t,D,this.chars,this.words,this.lines,e,u);return this.chars.reverse(),this.words.reverse(),this.lines.reverse(),this.isSplit=!0,this},C.revert=function revert(){const e=this._originals;if(!e)throw"revert() call wasn't scoped properly.";return this.elements.forEach(function(D,u){return D.innerHTML=e[u]}),this.chars=[],this.words=[],this.lines=[],this.isSplit=!1,this},SplitText.create=function create(D,u){return new SplitText(D,u)},SplitText);function SplitText(D,u){F||function _initCore(){X=document,e=window,F=1}(),this.elements=n(D),this.chars=[],this.words=[],this.lines=[],this._originals=[],this.vars=u||{},this.split(u)}l.version="3.11.3",D.SplitText=l,D.default=l;if(typeof window==="undefined"||window!==D){Object.defineProperty(D,"__esModule",{value:!0})}else{delete D.default}});function isTouch(){return false}function isNumber(duration){if(typeof duration==="number"&&!isNaN(duration)){return true}else if(typeof duration==="string"&&!isNaN(Number(duration))){return true}else{return false}}function getLineHeight(el){let overlay=$("#ad");const temp=document.createElement(el.nodeName);let ret;temp.setAttribute("style","margin:0; padding:0; line-height:normal;"+"font-family:"+(el.style.fontFamily||"inherit")+"; "+"font-size:"+(el.style.fontSize||"inherit"));temp.innerHTML="A";overlay.appendChild(temp);ret=temp.clientHeight;overlay.removeChild(temp);return ret}function fontWeight(s){s=s.toLowerCase().replace(/\s/g,"");const w=[8,6,7,5,4,2,3,1,9,9],f=["trabold","emibold","bold","medium","normal","tralight","light","thin","black","heavy"];for(let i=0;i<f.length;i++){if(s.slice(-f[i].length)===f[i])return w[i]*100}return"unset"}function evalInContext(src){eval(src)}